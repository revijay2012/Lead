const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SearchBar-YIDngrHy.js","assets/react-vendor-DtX1tuCI.js","assets/simpleSearchService-DmRmgA6D.js","assets/firebase-vendor-C5ggpXef.js","assets/ui-vendor-DFpyUtHP.js","assets/SearchResults-D4H8Tooj.js","assets/ResultDetailDrawer-CzD8tEsT.js","assets/LeadForm-Dss6BovE.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,R as s}from"./react-vendor-DtX1tuCI.js";import{_ as a,C as r,r as l,g as n,a as i,b as c,c as d,i as o,d as m,e as u,f as x,h,j as g,q as p,o as b,l as y,k as f,T as j,m as v,w as N,n as w,p as _,s as C,t as S,u as k,v as L}from"./firebase-vendor-C5ggpXef.js";import{U as D,P as T,B as A,C as E,E as $,a as F,X as P,S as I,F as R,b as O,c as U,A as q,d as B,e as M,f as z,g as V,h as W,i as H,j as G,k as Q,l as J,H as K,M as Y,m as X,D as Z,R as ee,n as te,o as se,T as ae,p as re,L as le,q as ne}from"./ui-vendor-DFpyUtHP.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var ie={exports:{}},ce={},de=e,oe=Symbol.for("react.element"),me=Symbol.for("react.fragment"),ue=Object.prototype.hasOwnProperty,xe=de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,he={key:!0,ref:!0,__self:!0,__source:!0};function ge(e,t,s){var a,r={},l=null,n=null;for(a in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(n=t.ref),t)ue.call(t,a)&&!he.hasOwnProperty(a)&&(r[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===r[a]&&(r[a]=t[a]);return{$$typeof:oe,type:e,key:l,ref:n,props:r,_owner:xe.current}}ce.Fragment=me,ce.jsx=ge,ce.jsxs=ge,ie.exports=ce;var pe=ie.exports,be={},ye=t;be.createRoot=ye.createRoot,be.hydrateRoot=ye.hydrateRoot;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const fe="functions";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class je{constructor(e,t,s){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(e=>this.auth=e,()=>{}),this.messaging||t.get().then(e=>this.messaging=e,()=>{}),this.appCheck||s.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null==e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ve="us-central1";class Ne{constructor(e,t,s,a,r=ve,l){this.app=e,this.fetchImpl=l,this.emulatorOrigin=null,this.contextProvider=new je(t,s,a),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(r);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=ve}catch(n){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){return`${this.emulatorOrigin}/${t}/${this.region}/${e}`}return null!==this.customDomain?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}const we="@firebase/functions",_e="0.11.8";function Ce(e,t,s){!function(e,t,s){e.emulatorOrigin=`http://${t}:${s}`}(c(e),t,s)}var Se,ke;
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Se=fetch.bind(self),a(new r(fe,(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),r=e.getProvider("messaging-internal"),l=e.getProvider("app-check-internal");return new Ne(s,a,r,l,t,Se)},"PUBLIC").setMultipleInstances(!0)),l(we,_e,ke),l(we,_e,"esm2017");const Le=o({apiKey:"demo-api-key",authDomain:"demo-no-project.firebaseapp.com",projectId:"demo-no-project",storageBucket:"demo-no-project.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:abcdef123456"}),De=m(Le),Te=u(Le),Ae=function(e=n(),t=ve){const s=i(c(e),fe).getImmediate({identifier:t}),a=d("functions");return a&&Ce(s,...a),s}(Le);try{x(De,"localhost",8080),h(Te,"http://localhost:9098"),Ce(Ae,"localhost",5002)}catch(mt){}function Ee(){const[t,s]=e.useState("Testing connection..."),[a,r]=e.useState(0);e.useEffect(()=>{l()},[]);const l=async()=>{try{try{x(De,"localhost",8080),s("✅ Connected to Firestore emulator")}catch(mt){s("⚠️  Emulator already connected or not available")}const e=g(De,"leads"),t=p(e,b("created_at","desc"),y(50)),a=await f(t);if(r(a.size),s(`✅ Connection successful! Found ${a.size} leads (showing first 50)`),a.size>0){const e=a.docs[0].data();s(`✅ Connection successful! Found ${a.size} leads. First: ${e.full_name}`)}}catch(mt){s(`❌ Connection failed: ${mt.message}`)}};return pe.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[pe.jsx("h3",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Firebase Connection Test"}),pe.jsx("p",{className:"text-blue-700",children:t}),a>0&&pe.jsxs("p",{className:"text-blue-600 mt-2",children:["📊 Total leads in database: ",a]}),pe.jsx("button",{onClick:l,className:"mt-2 px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Retest Connection"})]})}function $e({onViewLead:t,onEditLead:s}){const[a,r]=e.useState([]),[l,n]=e.useState(!0),[i,c]=e.useState(null);e.useEffect(()=>{d()},[]);const d=async()=>{try{n(!0);const e=g(De,"leads"),t=p(e,b("created_at","desc"),y(50)),s=(await f(t)).docs.map(e=>({lead_id:e.id,...e.data()}));r(s)}catch(e){c("Failed to load leads")}finally{n(!1)}},o=e=>{switch(e.toLowerCase()){case"customer":case"active":case"accepted":return"bg-green-100 text-green-800";case"new":case"draft":case"pending":return"bg-yellow-100 text-yellow-800";case"lost":case"expired":case"rejected":case"cancelled":return"bg-red-100 text-red-800";case"contacted":case"qualified":case"proposal":case"negotiation":case"sent":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},m=e=>{if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString()},u=(e,t="USD")=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e);return l?pe.jsxs("div",{className:"flex justify-center items-center py-12",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Loading leads..."})]}):i?pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx("div",{className:"text-red-600 mb-4",children:i}),pe.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]}):0===a.length?pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx(D,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No leads found"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Get started by adding your first lead."})]}):pe.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[pe.jsxs("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[pe.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:["All Leads (",a.length,")"]}),pe.jsx("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:"View and manage all your leads"})]}),pe.jsx("ul",{className:"divide-y divide-gray-200",children:a.map(e=>pe.jsx("li",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(D,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsxs("div",{children:[pe.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.full_name||`${e.first_name} ${e.last_name}`}),pe.jsx("p",{className:"text-sm text-gray-500",children:e.email})]})]}),pe.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${o(e.status)}`,children:e.status})]}),pe.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500 space-x-4",children:[e.phone&&pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(T,{className:"h-4 w-4 mr-1"}),e.phone]}),e.company&&pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(A,{className:"h-4 w-4 mr-1"}),e.company]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(E,{className:"h-4 w-4 mr-1"}),m(e.created_at)]}),e.contract_value&&pe.jsx("div",{className:"text-green-600 font-medium",children:u(e.contract_value)})]}),pe.jsx("div",{className:"mt-2 flex items-center text-xs text-gray-400",children:pe.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded font-mono",children:["ID: ",e.lead_id]})})]}),pe.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[pe.jsxs("button",{onClick:()=>t(e),className:"inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[pe.jsx($,{className:"h-3 w-3 mr-1"}),"View"]}),pe.jsxs("button",{onClick:()=>s(e),className:"inline-flex items-center px-2 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[pe.jsx(F,{className:"h-3 w-3 mr-1"}),"Edit"]})]})]})},e.lead_id))})]})}const Fe=Object.freeze(Object.defineProperty({__proto__:null,LeadsList:$e},Symbol.toStringTag,{value:"Module"}));class Pe{static generateEventId(){const e=new Date,t=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0"),String(e.getSeconds()).padStart(2,"0");return`EVT-${t}${s}${a}-${Math.floor(1e3*Math.random()).toString().padStart(3,"0")}`}static generateSearchKeywords(e,t,s,a,r){const l=new Set;if(l.add(e.toLowerCase()),l.add(t.toLowerCase()),s){s.toLowerCase().split(/\s+/).filter(e=>e.length>2).forEach(e=>l.add(e))}if(a){a.toLowerCase().split(/\s+/).filter(e=>e.length>2).forEach(e=>l.add(e))}if(r){r.toLowerCase().split(/\s+/).filter(e=>e.length>2).forEach(e=>l.add(e))}return l.add("status"),l.add("change"),l.add("transition"),l.add("update"),Array.from(l)}static async recordStatusChange(e,t,s,a,r,l,n,i={}){try{const c=this.generateEventId(),d={previous_status:a,to_status:r,changed_by:l,changed_at:j.now(),reason:n,auto_triggered:i.autoTriggered||!1,search_keywords:this.generateSearchKeywords(a,r,n,l,i.comments),lead_id:e,lead_name:t,lead_email:s,notes:i.notes,comments:i.comments,previous_data:i.previousData,new_data:i.newData};await v(g(De,"leads",e,"status_history"),d);return c}catch(mt){throw mt}}static async getStatusHistory(e,t={}){try{const{limit:s=50,orderBy:a="changed_at",orderDirection:r="desc"}=t,l=p(g(De,"leads",e,"status_history"),b(a,r),y(s)),n=await f(l);return n.docs.map(e=>({event_id:e.data().event_id||e.id,...e.data()}))}catch(mt){return[]}}static async getGlobalStatusHistory(e={}){try{const{limit:t=100}=e,s=await f(g(De,"leads")),a=[];for(const r of s.docs)try{const t=(await this.getStatusHistory(r.id,{limit:20})).filter(t=>(!e.status||t.to_status===e.status)&&((!e.changedBy||t.changed_by===e.changedBy)&&(!(e.dateFrom&&t.changed_at.toDate()<e.dateFrom)&&!(e.dateTo&&t.changed_at.toDate()>e.dateTo))));a.push(...t)}catch(mt){}a.sort((e,t)=>t.changed_at.toMillis()-e.changed_at.toMillis());return a.slice(0,t)}catch(mt){return[]}}static async getStatusChangeStats(e={}){try{const t=await this.getGlobalStatusHistory({limit:1e3,...e}),s={totalChanges:t.length,changesByStatus:{},changesByUser:{},autoTriggeredCount:0};return["new","contacted","qualified","proposal","negotiation","closed-won","closed-lost"].forEach(e=>{s.changesByStatus[e]=0}),t.forEach(e=>{s.changesByStatus[e.to_status]++,s.changesByUser[e.changed_by]=(s.changesByUser[e.changed_by]||0)+1,e.auto_triggered&&s.autoTriggeredCount++}),s}catch(mt){return{totalChanges:0,changesByStatus:{},changesByUser:{},autoTriggeredCount:0}}}static async searchStatusHistory(e,t={}){try{const{leadId:s,limit:a=50}=t,r=e.toLowerCase().trim();if(s){const e=await this.getStatusHistory(s,{limit:200});return e.filter(e=>e.reason.toLowerCase().includes(r)||e.changed_by.toLowerCase().includes(r)||e.previous_status.toLowerCase().includes(r)||e.to_status.toLowerCase().includes(r)||e.search_keywords.some(e=>e.includes(r))).slice(0,a)}{const e=await this.getGlobalStatusHistory({limit:500});return e.filter(e=>e.reason.toLowerCase().includes(r)||e.changed_by.toLowerCase().includes(r)||e.previous_status.toLowerCase().includes(r)||e.to_status.toLowerCase().includes(r)||e.search_keywords.some(e=>e.includes(r))).slice(0,a)}}catch(mt){return[]}}}function Ie(e){if(!e)return[];const t=new Set;return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).filter(e=>e.length>2).forEach(e=>{t.add(e);for(let s=3;s<=Math.min(e.length,8);s++)t.add(e.slice(0,s))}),Array.from(t)}function Re(e,t=15){const s=e.toLowerCase().trim();if(!s)return[];const a=[];for(let r=1;r<=Math.min(s.length,t);r++)a.push(s.slice(0,r));return a}class Oe{static async updateLead(e,t,s,a,r){var l;try{const i=N(De),c=w(De,"leads",e),d=null==(l=(await f(p(g(De,"leads"),_("__name__","==",e)))).docs[0])?void 0:l.data();if(!d)throw new Error("Lead not found");const o=t.status&&t.status!==d.status,m=d.status,u={...t,updated_at:j.now()};if(t.first_name||t.last_name||t.full_name||t.email||t.company){const e=function(e){const t=(e.first_name||"").toLowerCase(),s=(e.last_name||"").toLowerCase(),a=`${t} ${s}`.trim(),r=(e.email||"").toLowerCase(),l=(e.phone||"").replace(/\D/g,""),n=(e.company||"").toLowerCase(),i=new Set([...Re(t),...Re(s),...Re(a),...Re(r),...Re(l),...Re(n)]);return Array.from(i)}({first_name:t.first_name||d.first_name,last_name:t.last_name||d.last_name,email:t.email||d.email,phone:t.phone||d.phone,company:t.company||d.company});u.search_prefixes=e}i.update(c,u);const x=w(g(De,"leads",e,"audit_log")),h={changed_by:s,fields_changed:Object.keys(t).map(e=>({field:e,old_value:d[e],new_value:t[e],field_type:typeof t[e]})),timestamp:j.now(),search_keywords:Ie(`lead update ${d.full_name} ${t.status||d.status}`),lead_id:e,lead_name:t.full_name||d.full_name,lead_email:t.email||d.email,change_type:o?"status_change":"update",reason:a||"Lead updated",automated:!1};if(i.set(x,{...h,log_id:x.id}),o){const r=w(g(De,"leads",e,"status_history")),l={from_status:d.status,to_status:t.status,transition_reason:a||"Status updated",timestamp:j.now(),changed_by:s,search_keywords:Ie(`${d.status} to ${t.status} ${d.full_name}`),lead_id:e,lead_name:t.full_name||d.full_name,lead_email:t.email||d.email,notes:`Status changed from ${d.status} to ${t.status}`,automated:!1};i.set(r,{...l,event_id:r.id})}if(await i.commit(),o&&t.status)try{await Pe.recordStatusChange(e,d.full_name||`${d.first_name} ${d.last_name}`,d.email,m,t.status,s,a||"Status updated",{autoTriggered:!1,notes:a,comments:null==r?void 0:r.comments,previousData:{status:m},newData:{status:t.status}})}catch(n){}}catch(mt){throw mt}}static async addActivity(e,t,s,a,r){try{const n={...t,subject_lower:t.subject.toLowerCase(),notes_lower:(t.notes||"").toLowerCase(),timestamp:j.now(),search_keywords:Ie(`${t.subject} ${t.notes||""}`),lead_id:e,lead_name:s,lead_email:a,created_by:r},i=await v(g(De,"leads",e,"activities"),n);try{await this.createAuditLog(e,s,a,r,"subcollection_change",{subcollection_type:"activities",subcollection_id:i.id,reason:`Activity added: ${t.subject}`})}catch(l){}return i.id}catch(mt){throw mt}}static async addProposal(e,t,s,a,r){try{const l={...t,sent_at:j.now(),search_keywords:Ie(`${t.title} ${t.description||""}`),lead_id:e,lead_name:s,lead_email:a,created_by:r},n=await v(g(De,"leads",e,"proposals"),l);return await this.createAuditLog(e,s,a,r,"subcollection_change",{subcollection_type:"proposals",subcollection_id:n.id,reason:`Proposal added: ${t.title}`}),n.id}catch(mt){throw mt}}static async addContract(e,t,s,a,r){try{const l={...t,search_keywords:Ie(`${t.title||"Contract"} ${t.notes||""}`),lead_id:e,lead_name:s,lead_email:a,created_by:r},n=await v(g(De,"leads",e,"contracts"),l);return await this.createAuditLog(e,s,a,r,"subcollection_change",{subcollection_type:"contracts",subcollection_id:n.id,reason:`Contract added: ${t.title||"New Contract"}`}),n.id}catch(mt){throw mt}}static async createAuditLog(e,t,s,a,r,l={}){try{const n=w(g(De,"leads",e,"audit_log")),i={changed_by:a,fields_changed:[],timestamp:j.now(),search_keywords:Ie(`audit ${r} ${t}`),lead_id:e,lead_name:t,lead_email:s,change_type:r,reason:"System generated audit log",automated:!0,...l};await v(g(De,"leads",e,"audit_log"),{...i,log_id:n.id})}catch(mt){}}static async getLeadWithSubcollections(e){try{let t=e;if(e.startsWith("L-")){const s=p(g(De,"leads"),_("lead_id","==",e)),a=await f(s);if(a.empty)return{activities:[],proposals:[],contracts:[],statusHistory:[],auditLog:[]};t=a.docs[0].id}const[s,a,r,l,n]=await Promise.all([f(g(De,"leads",t,"activities")),f(g(De,"leads",t,"proposals")),f(g(De,"leads",t,"contracts")),f(g(De,"leads",t,"status_history")),f(g(De,"leads",t,"audit_log"))]);return{activities:s.docs.map(e=>({id:e.id,...e.data()})),proposals:a.docs.map(e=>({id:e.id,...e.data()})),contracts:r.docs.map(e=>({id:e.id,...e.data()})),statusHistory:l.docs.map(e=>({id:e.id,...e.data()})),auditLog:n.docs.map(e=>({id:e.id,...e.data()}))}}catch(mt){return{activities:[],proposals:[],contracts:[],statusHistory:[],auditLog:[]}}}}function Ue({leadId:t,leadName:s,leadEmail:a,onClose:r,onSuccess:l}){const[n,i]=e.useState(!1),[c,d]=e.useState({type:"call",subject:"",notes:"",duration:"",outcome:"",priority:"medium",status:"completed"});return pe.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:pe.jsxs("div",{className:"flex min-h-full items-center justify-center p-4",children:[pe.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:r}),pe.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-md w-full mt-8",children:[pe.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[pe.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Add Activity"}),pe.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:pe.jsx(P,{className:"h-5 w-5"})})]}),pe.jsxs("form",{onSubmit:async e=>{e.preventDefault(),i(!0);try{await Oe.addActivity(t,{...c,duration:c.duration?parseInt(c.duration):void 0,subject_lower:c.subject.toLowerCase(),notes_lower:c.notes.toLowerCase(),status:c.status,priority:c.priority,created_by:"Current User"},s,a,"Current User"),l(),r(),alert("Activity added successfully!")}catch(mt){alert("Failed to add activity. Please try again.")}finally{i(!1)}},className:"p-6 space-y-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Activity Type"}),pe.jsxs("select",{value:c.type,onChange:e=>d(t=>({...t,type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",required:!0,children:[pe.jsx("option",{value:"call",children:"Call"}),pe.jsx("option",{value:"email",children:"Email"}),pe.jsx("option",{value:"meeting",children:"Meeting"}),pe.jsx("option",{value:"note",children:"Note"}),pe.jsx("option",{value:"task",children:"Task"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),pe.jsx("input",{type:"text",value:c.subject,onChange:e=>d(t=>({...t,subject:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Activity subject",required:!0})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),pe.jsx("textarea",{value:c.notes,onChange:e=>d(t=>({...t,notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",rows:3,placeholder:"Activity notes"})]}),pe.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),pe.jsx("input",{type:"number",value:c.duration,onChange:e=>d(t=>({...t,duration:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"30"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Priority"}),pe.jsxs("select",{value:c.priority,onChange:e=>d(t=>({...t,priority:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"low",children:"Low"}),pe.jsx("option",{value:"medium",children:"Medium"}),pe.jsx("option",{value:"high",children:"High"})]})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:c.status,onChange:e=>d(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"completed",children:"Completed"}),pe.jsx("option",{value:"pending",children:"Pending"}),pe.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Outcome"}),pe.jsx("input",{type:"text",value:c.outcome,onChange:e=>d(t=>({...t,outcome:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Activity outcome"})]}),pe.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[pe.jsx("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancel"}),pe.jsx("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 flex items-center",children:n?pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):pe.jsxs(pe.Fragment,{children:[pe.jsx(I,{className:"h-4 w-4 mr-2"}),"Save Activity"]})})]})]})]})]})})}function qe({leadId:t,leadName:s,leadEmail:a,className:r=""}){const[l,n]=e.useState([]),[i,c]=e.useState(!0),[d,o]=e.useState(null),[m,u]=e.useState(new Set),[x,h]=e.useState(""),[g,p]=e.useState(!1),[b,y]=e.useState({status:"",changedBy:"",autoTriggered:"",dateFrom:"",dateTo:""});e.useEffect(()=>{f()},[t]);const f=async()=>{try{c(!0),o(null);const e=await Pe.getStatusHistory(t,{limit:100,orderBy:"changed_at",orderDirection:"desc"});n(e)}catch(e){o("Failed to load status history")}finally{c(!1)}},j=e=>{switch(e){case"new":return"bg-yellow-100 text-yellow-800";case"contacted":return"bg-blue-100 text-blue-800";case"qualified":case"closed-won":return"bg-green-100 text-green-800";case"proposal":return"bg-purple-100 text-purple-800";case"negotiation":return"bg-orange-100 text-orange-800";case"closed-lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},v=e=>{if(!e)return"N/A";const t=e.toDate?e.toDate():new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},N=l.filter(e=>{if(x){const t=x.toLowerCase();if(!(e.reason.toLowerCase().includes(t)||e.changed_by.toLowerCase().includes(t)||e.previous_status.toLowerCase().includes(t)||e.to_status.toLowerCase().includes(t)||e.event_id.toLowerCase().includes(t)||e.comments&&e.comments.toLowerCase().includes(t)||e.notes&&e.notes.toLowerCase().includes(t)))return!1}if(b.status&&e.to_status!==b.status)return!1;if(b.changedBy&&!e.changed_by.toLowerCase().includes(b.changedBy.toLowerCase()))return!1;if(""!==b.autoTriggered){const t="true"===b.autoTriggered;if(e.auto_triggered!==t)return!1}if(b.dateFrom){if((e.changed_at.toDate?e.changed_at.toDate():new Date(e.changed_at))<new Date(b.dateFrom))return!1}if(b.dateTo){if((e.changed_at.toDate?e.changed_at.toDate():new Date(e.changed_at))>new Date(b.dateTo))return!1}return!0});return i?pe.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${r}`,children:pe.jsxs("div",{className:"flex items-center justify-center py-8",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Loading status history..."})]})}):d?pe.jsx("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${r}`,children:pe.jsxs("div",{className:"text-center py-8",children:[pe.jsx("div",{className:"text-red-600 mb-2",children:d}),pe.jsx("button",{onClick:f,className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:"Try Again"})]})}):pe.jsxs("div",{className:`bg-white rounded-lg shadow-sm border border-gray-200 ${r}`,children:[pe.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{children:[pe.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Status History"}),pe.jsxs("p",{className:"text-sm text-gray-500",children:[s," • ",a]})]}),pe.jsxs("button",{onClick:()=>p(!g),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+(g?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Filters"]})]})}),pe.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[pe.jsx("div",{className:"flex items-center space-x-4 mb-4",children:pe.jsxs("div",{className:"flex-1 relative",children:[pe.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),pe.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Search status history...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})}),g&&pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[pe.jsxs("select",{value:b.status,onChange:e=>y(t=>({...t,status:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"All Statuses"}),pe.jsx("option",{value:"new",children:"New"}),pe.jsx("option",{value:"contacted",children:"Contacted"}),pe.jsx("option",{value:"qualified",children:"Qualified"}),pe.jsx("option",{value:"proposal",children:"Proposal"}),pe.jsx("option",{value:"negotiation",children:"Negotiation"}),pe.jsx("option",{value:"closed-won",children:"Closed Won"}),pe.jsx("option",{value:"closed-lost",children:"Closed Lost"})]}),pe.jsx("input",{type:"text",value:b.changedBy,onChange:e=>y(t=>({...t,changedBy:e.target.value})),placeholder:"Changed by...",className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),pe.jsxs("select",{value:b.autoTriggered,onChange:e=>y(t=>({...t,autoTriggered:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"All Changes"}),pe.jsx("option",{value:"true",children:"Auto Triggered"}),pe.jsx("option",{value:"false",children:"Manual"})]}),pe.jsx("input",{type:"date",value:b.dateFrom,onChange:e=>y(t=>({...t,dateFrom:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),pe.jsx("input",{type:"date",value:b.dateTo,onChange:e=>y(t=>({...t,dateTo:e.target.value})),className:"px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),(x||Object.values(b).some(e=>e))&&pe.jsxs("div",{className:"mt-4 flex justify-between items-center",children:[pe.jsxs("span",{className:"text-sm text-gray-500",children:["Showing ",N.length," of ",l.length," entries"]}),pe.jsx("button",{onClick:()=>{y({status:"",changedBy:"",autoTriggered:"",dateFrom:"",dateTo:""}),h("")},className:"text-sm text-blue-600 hover:text-blue-800",children:"Clear filters"})]})]}),pe.jsx("div",{className:"divide-y divide-gray-200",children:0===N.length?pe.jsxs("div",{className:"px-6 py-12 text-center",children:[pe.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No status history found"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:0===l.length?"No status changes have been recorded for this lead.":"Try adjusting your search terms or filters."})]}):N.map(e=>pe.jsxs("div",{className:"px-6 py-4",children:[pe.jsxs("div",{className:"flex items-start justify-between",children:[pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[pe.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${j(e.previous_status)}`,children:e.previous_status}),pe.jsx(q,{className:"h-4 w-4 text-gray-400"}),pe.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${j(e.to_status)}`,children:e.to_status}),e.auto_triggered&&pe.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[pe.jsx(B,{className:"h-3 w-3 mr-1"}),"Auto"]})]}),pe.jsxs("div",{className:"flex items-center text-sm text-gray-600 space-x-4 mb-2",children:[pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(D,{className:"h-4 w-4 mr-1"}),e.changed_by]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(E,{className:"h-4 w-4 mr-1"}),v(e.changed_at)]})]}),pe.jsx("p",{className:"text-sm text-gray-800 mb-2",children:e.reason}),e.comments&&pe.jsxs("div",{className:"mb-2",children:[pe.jsx("p",{className:"text-xs font-medium text-gray-700 mb-1",children:"Comments:"}),pe.jsx("p",{className:"text-sm text-gray-600 bg-blue-50 p-2 rounded border-l-4 border-blue-200",children:e.comments})]}),e.notes&&pe.jsx("p",{className:"text-sm text-gray-600",children:e.notes}),pe.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Event ID: ",e.event_id]})]}),pe.jsx("button",{onClick:()=>(e=>{const t=new Set(m);t.has(e)?t.delete(e):t.add(e),u(t)})(e.event_id),className:"ml-4 p-1 text-gray-400 hover:text-gray-600",children:m.has(e.event_id)?pe.jsx(M,{className:"h-4 w-4"}):pe.jsx(z,{className:"h-4 w-4"})})]}),m.has(e.event_id)&&pe.jsx("div",{className:"mt-4 pl-4 border-l-2 border-gray-200",children:pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[pe.jsxs("div",{children:[pe.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Previous Data"}),pe.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs text-gray-700 overflow-x-auto",children:JSON.stringify(e.previous_data||{status:e.previous_status},null,2)})]}),pe.jsxs("div",{children:[pe.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"New Data"}),pe.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs text-gray-700 overflow-x-auto",children:JSON.stringify(e.new_data||{status:e.to_status},null,2)})]})]})})]},e.event_id))})]})}const Be=[{value:"new",label:"New",color:"bg-yellow-100 text-yellow-800"},{value:"contacted",label:"Contacted",color:"bg-blue-100 text-blue-800"},{value:"qualified",label:"Qualified",color:"bg-green-100 text-green-800"},{value:"proposal",label:"Proposal",color:"bg-purple-100 text-purple-800"},{value:"negotiation",label:"Negotiation",color:"bg-orange-100 text-orange-800"},{value:"closed-won",label:"Closed Won",color:"bg-green-100 text-green-800"},{value:"closed-lost",label:"Closed Lost",color:"bg-red-100 text-red-800"}],Me=["Initial contact made","Budget confirmed","Decision maker identified","Requirements clarified","Proposal submitted","Negotiation started","Contract signed","Deal closed","Budget not available","No decision maker","Competitor chosen","Timing not right","Requirements changed","Lost to competitor"];function ze({isOpen:t,onClose:s,onSave:a,currentStatus:r,leadName:l}){var n,i;const[c,d]=e.useState(r),[o,m]=e.useState(""),[u,x]=e.useState(""),[h,g]=e.useState(""),[p,b]=e.useState(!1),[y,f]=e.useState(""),j=()=>{d(r),m(""),x(""),g(""),f(""),b(!1),s()};return t?pe.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:pe.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto",children:[pe.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[pe.jsxs("div",{children:[pe.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Change Lead Status"}),pe.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l})]}),pe.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 transition-colors",children:pe.jsx(P,{className:"h-6 w-6"})})]}),pe.jsxs("div",{className:"p-6 space-y-6",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Status"}),pe.jsx("div",{className:"flex items-center space-x-2",children:pe.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${(null==(n=Be.find(e=>e.value===r))?void 0:n.color)||"bg-gray-100 text-gray-800"}`,children:(null==(i=Be.find(e=>e.value===r))?void 0:i.label)||r})})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Status *"}),pe.jsx("div",{className:"grid grid-cols-2 gap-2",children:Be.map(e=>pe.jsx("button",{onClick:()=>d(e.value),disabled:e.value===r,className:"p-3 rounded-lg border text-left transition-all "+(c===e.value?"border-blue-500 bg-blue-50":e.value===r?"border-gray-200 bg-gray-50 text-gray-400 cursor-not-allowed":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:pe.jsx("div",{className:"flex items-center space-x-2",children:pe.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e.color}`,children:e.label})})},e.value))})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Change *"}),pe.jsxs("div",{className:"mb-3",children:[pe.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"Quick select:"}),pe.jsx("div",{className:"flex flex-wrap gap-2",children:Me.map(e=>pe.jsx("button",{onClick:()=>{m(e)},className:"px-3 py-1 text-xs rounded-full border transition-colors "+(o===e?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:e},e))})]}),pe.jsx("textarea",{value:o,onChange:e=>m(e.target.value),placeholder:"Describe why you're changing the status...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Comments"}),pe.jsx("textarea",{value:u,onChange:e=>x(e.target.value),placeholder:"Add any additional notes or context about this status change...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3}),pe.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"These comments will be stored with the status history and are searchable."})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Note to Activities"}),pe.jsx("textarea",{value:h,onChange:e=>g(e.target.value),placeholder:"This will create a separate note entry in the activities section with timestamp...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-green-500 focus:border-green-500",rows:3}),pe.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will create a separate note activity entry with timestamp that appears in the Activities section."})]}),y&&pe.jsxs("div",{className:"flex items-center space-x-2 p-3 bg-red-50 border border-red-200 rounded-md",children:[pe.jsx(V,{className:"h-4 w-4 text-red-500"}),pe.jsx("span",{className:"text-sm text-red-700",children:y})]})]}),pe.jsxs("div",{className:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200 bg-gray-50",children:[pe.jsx("button",{onClick:j,disabled:p,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:"Cancel"}),pe.jsx("button",{onClick:async()=>{if(o.trim())if(c!==r){b(!0),f("");try{await a(c,o.trim(),u.trim(),h.trim()),j()}catch(e){f("Failed to update status. Please try again.")}finally{b(!1)}}else f("Please select a different status");else f("Please provide a reason for the status change")},disabled:p||c===r||!o.trim(),className:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:p?pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):pe.jsxs(pe.Fragment,{children:[pe.jsx(I,{className:"h-4 w-4 mr-2"}),"Update Status"]})})]})]})}):null}function Ve({leadId:t,leadName:s,leadEmail:a,className:r=""}){const[l,n]=e.useState(!1),[i,c]=e.useState([]),[d,o]=e.useState(""),[m,u]=e.useState(!1),[x,h]=e.useState("");e.useEffect(()=>{l&&g()},[l,t]);const g=async()=>{try{u(!0);const e=(await Oe.getLeadWithSubcollections(t)).activities.filter(e=>"note"===e.type);c(e)}catch(e){h("Failed to load notes")}finally{u(!1)}},p=e=>{if(!e)return"N/A";const t=e.toDate?e.toDate():new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()};return pe.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg ${r}`,children:[pe.jsxs("button",{onClick:()=>n(!l),className:"w-full px-4 py-3 text-left flex items-center justify-between hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset",children:[pe.jsxs("div",{className:"flex items-center",children:[l?pe.jsx(M,{className:"h-4 w-4 text-gray-500 mr-2"}):pe.jsx(z,{className:"h-4 w-4 text-gray-500 mr-2"}),pe.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Notes (",i.length,")"]})]}),pe.jsx(W,{className:"h-4 w-4 text-gray-400"})]}),l&&pe.jsxs("div",{className:"border-t border-gray-200",children:[pe.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:pe.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),d.trim()){u(!0),h("");try{await Oe.addActivity(t,{type:"note",subject:"Note",notes:d.trim(),timestamp:new Date},s,a,"system"),o(""),await g()}catch(r){h("Failed to add note. Please try again.")}finally{u(!1)}}else h("Please enter a note")},className:"space-y-3",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Add New Note"}),pe.jsx("textarea",{value:d,onChange:e=>o(e.target.value),placeholder:"Enter your note here...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),x&&pe.jsxs("div",{className:"flex items-center space-x-2 p-2 bg-red-50 border border-red-200 rounded-md",children:[pe.jsx(V,{className:"h-4 w-4 text-red-500"}),pe.jsx("span",{className:"text-sm text-red-700",children:x})]}),pe.jsx("div",{className:"flex items-center justify-end",children:pe.jsx("button",{type:"submit",disabled:m||!d.trim(),className:"inline-flex items-center px-3 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:m?pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Adding..."]}):pe.jsxs(pe.Fragment,{children:[pe.jsx(H,{className:"h-4 w-4 mr-2"}),"Add Note"]})})})]})}),pe.jsx("div",{className:"max-h-96 overflow-y-auto",children:m&&0===i.length?pe.jsxs("div",{className:"p-8 text-center",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),pe.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Loading notes..."})]}):0===i.length?pe.jsxs("div",{className:"p-8 text-center",children:[pe.jsx(U,{className:"h-12 w-12 text-gray-400 mx-auto"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No notes yet"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Add your first note using the form above."})]}):pe.jsx("div",{className:"divide-y divide-gray-200",children:i.map((e,t)=>pe.jsx("div",{className:"p-4",children:pe.jsxs("div",{className:"flex items-start space-x-3",children:[pe.jsx("div",{className:"flex-shrink-0",children:pe.jsx("div",{className:"h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center",children:pe.jsx(D,{className:"h-4 w-4 text-blue-600"})})}),pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.created_by||"System"}),pe.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[pe.jsx(U,{className:"h-3 w-3 mr-1"}),p(e.timestamp)]})]}),pe.jsx("div",{className:"mt-1",children:pe.jsx("p",{className:"text-sm text-gray-700 whitespace-pre-wrap",children:e.notes})}),e.subject&&"Note"!==e.subject&&pe.jsx("div",{className:"mt-2",children:pe.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e.subject})})]})]})},e.activity_id||t))})})]})]})}function We({lead:t,onClose:s}){var a,r,l,n;const[i,c]=e.useState("overview"),[d,o]=e.useState([]),[m,u]=e.useState([]),[x,h]=e.useState([]),[g,p]=e.useState([]),[b,y]=e.useState([]),[f,j]=e.useState(!0),[v,N]=e.useState(!1),[w,_]=e.useState(!1);e.useEffect(()=>{C()},[t.lead_id]);const C=e.useCallback(async()=>{try{j(!0);const e=await Oe.getLeadWithSubcollections(t.lead_id);o(e.activities),u(e.proposals),h(e.contracts),p(e.statusHistory),y(e.auditLog)}catch(mt){}finally{j(!1)}},[t.lead_id]),S=e=>{if(!e)return"N/A";const t=e.toDate?e.toDate():new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString()},k=e=>{switch(e.toLowerCase()){case"new":return"bg-yellow-100 text-yellow-800";case"contacted":return"bg-blue-100 text-blue-800";case"qualified":case"closed-won":return"bg-green-100 text-green-800";case"proposal":return"bg-purple-100 text-purple-800";case"negotiation":return"bg-orange-100 text-orange-800";case"closed-lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},L=[{id:"overview",label:"Overview",icon:$},{id:"activities",label:`Activities (${d.filter(e=>"note"!==e.type).length})`,icon:G},{id:"proposals",label:`Proposals (${m.length})`,icon:Q},{id:"contracts",label:`Contracts (${x.length})`,icon:J},{id:"history",label:`Status History (${g.length})`,icon:K},{id:"audit",label:`Audit Log (${b.length})`,icon:U}];return pe.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:pe.jsxs("div",{className:"flex min-h-full items-center justify-center p-4",children:[pe.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:s}),pe.jsxs("div",{className:"relative bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[95vh] overflow-hidden mt-8",children:[pe.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[pe.jsxs("div",{children:[pe.jsx("h3",{className:"text-2xl font-semibold text-gray-900",children:t.full_name}),pe.jsxs("p",{className:"text-gray-600",children:[t.company," • ",t.email]})]}),pe.jsxs("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:[pe.jsx("span",{className:"sr-only",children:"Close"}),pe.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:pe.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),pe.jsxs("div",{className:"p-4 bg-yellow-50 border-b border-yellow-200",children:[pe.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Debug Info (LeadDetailManagement):"}),pe.jsxs("div",{className:"text-xs text-yellow-700",children:[pe.jsxs("p",{children:["Lead ID: ",t.lead_id||"NO LEAD_ID"]}),pe.jsxs("p",{children:["Lead Name: ",t.first_name," ",t.last_name]}),pe.jsxs("p",{children:["Activities Count: ",d.length]}),pe.jsxs("p",{children:["Proposals Count: ",m.length]}),pe.jsxs("p",{children:["Contracts Count: ",x.length]}),pe.jsxs("p",{children:["Loading: ",f?"Yes":"No"]})]})]}),pe.jsx("div",{className:"border-b border-gray-200",children:pe.jsx("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:L.map(e=>{const t=e.icon;return pe.jsxs("button",{onClick:()=>c(e.id),className:(i===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300")+" whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm flex items-center space-x-2",children:[pe.jsx(t,{className:"h-4 w-4"}),pe.jsx("span",{children:e.label})]},e.id)})})}),pe.jsx("div",{className:"flex-1 overflow-y-auto max-h-[calc(95vh-200px)]",children:f?pe.jsxs("div",{className:"flex justify-center items-center py-12",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Loading..."})]}):pe.jsxs("div",{className:"p-6",children:["overview"===i&&pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[pe.jsxs("div",{children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Contact Information"}),pe.jsxs("div",{className:"space-y-3",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(D,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsx("span",{className:"text-gray-900",children:t.full_name})]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(Y,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsx("span",{className:"text-gray-900",children:t.email})]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(T,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsx("span",{className:"text-gray-900",children:t.phone||"Not provided"})]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(A,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsx("span",{className:"text-gray-900",children:t.company})]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(X,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsxs("span",{className:"text-gray-900",children:[null==(a=t.address)?void 0:a.street,", ",null==(r=t.address)?void 0:r.city,", ",null==(l=t.address)?void 0:l.state]})]})]})]}),pe.jsxs("div",{children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Lead Information"}),pe.jsxs("div",{className:"space-y-3",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Status"}),pe.jsx("span",{className:`ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k(t.status)}`,children:t.status})]}),pe.jsxs("button",{onClick:()=>N(!0),className:"inline-flex items-center px-2 py-1 text-xs font-medium text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md transition-colors",children:[pe.jsx(F,{className:"h-3 w-3 mr-1"}),"Change"]})]}),pe.jsxs("div",{children:[pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Stage"}),pe.jsx("span",{className:"ml-2 text-gray-900 capitalize",children:t.stage})]}),pe.jsxs("div",{children:[pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Source"}),pe.jsx("span",{className:"ml-2 text-gray-900",children:t.source})]}),pe.jsxs("div",{children:[pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Contract Value"}),pe.jsxs("span",{className:"ml-2 text-gray-900",children:["$",null==(n=t.contract_value)?void 0:n.toLocaleString()]})]}),pe.jsxs("div",{children:[pe.jsx("span",{className:"text-sm font-medium text-gray-500",children:"Created"}),pe.jsx("span",{className:"ml-2 text-gray-900",children:S(t.created_at)})]})]})]})]}),"activities"===i&&pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex justify-between items-center mb-4",children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Activities"}),pe.jsxs("button",{onClick:()=>_(!0),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Activity"]})]}),pe.jsx("div",{className:"mb-6",children:pe.jsx(Ve,{leadId:t.lead_id,leadName:t.full_name||`${t.first_name} ${t.last_name}`,leadEmail:t.email})}),pe.jsxs("div",{className:"space-y-4",children:[d.filter(e=>"note"!==e.type).map(e=>pe.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:pe.jsxs("div",{className:"flex justify-between items-start",children:[pe.jsxs("div",{children:[pe.jsx("h5",{className:"font-medium text-gray-900",children:e.subject}),pe.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.notes}),pe.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(G,{className:"h-3 w-3 mr-1"}),e.type]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(U,{className:"h-3 w-3 mr-1"}),S(e.timestamp)]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(D,{className:"h-3 w-3 mr-1"}),e.created_by]})]})]}),pe.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status||"completed"})]})},e.activity_id)),0===d.length&&pe.jsxs("div",{className:"text-center py-8 text-gray-500",children:[pe.jsx(G,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("p",{className:"mt-2",children:"No activities recorded"})]})]})]}),"proposals"===i&&pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex justify-between items-center mb-4",children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Proposals"}),pe.jsxs("button",{className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Proposal"]})]}),pe.jsxs("div",{className:"space-y-4",children:[m.map(e=>{var t;return pe.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:pe.jsxs("div",{className:"flex justify-between items-start",children:[pe.jsxs("div",{children:[pe.jsx("h5",{className:"font-medium text-gray-900",children:e.title}),pe.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),pe.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(Z,{className:"h-3 w-3 mr-1"}),"$",(null==(t=e.amount)?void 0:t.toLocaleString())||"N/A"]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),S(e.sent_at)]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(D,{className:"h-3 w-3 mr-1"}),e.created_by]})]})]}),pe.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k(e.status)}`,children:e.status})]})},e.proposal_id)}),0===m.length&&pe.jsxs("div",{className:"text-center py-8 text-gray-500",children:[pe.jsx(Q,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("p",{className:"mt-2",children:"No proposals sent"})]})]})]}),"contracts"===i&&pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex justify-between items-center mb-4",children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900",children:"Contracts"}),pe.jsxs("button",{className:"inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Contract"]})]}),pe.jsxs("div",{className:"space-y-4",children:[x.map(e=>{var t;return pe.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:pe.jsxs("div",{className:"flex justify-between items-start",children:[pe.jsxs("div",{children:[pe.jsx("h5",{className:"font-medium text-gray-900",children:e.title||"Contract"}),pe.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.notes}),pe.jsxs("div",{className:"flex items-center mt-2 space-x-4 text-xs text-gray-500",children:[pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(Z,{className:"h-3 w-3 mr-1"}),"$",(null==(t=e.amount)?void 0:t.toLocaleString())||"N/A"]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),S(e.start_date)," - ",S(e.end_date)]}),pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(D,{className:"h-3 w-3 mr-1"}),e.created_by]})]})]}),pe.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${k(e.status)}`,children:e.status})]})},e.contract_id)}),0===x.length&&pe.jsxs("div",{className:"text-center py-8 text-gray-500",children:[pe.jsx(J,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("p",{className:"mt-2",children:"No contracts signed"})]})]})]}),"history"===i&&pe.jsx(qe,{leadId:t.lead_id,leadName:t.full_name||`${t.first_name} ${t.last_name}`,leadEmail:t.email}),"audit"===i&&pe.jsxs("div",{children:[pe.jsx("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Audit Log"}),pe.jsxs("div",{className:"space-y-4",children:[b.map(e=>pe.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:pe.jsxs("div",{className:"flex justify-between items-start",children:[pe.jsxs("div",{children:[pe.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("create"===e.change_type?"bg-green-100 text-green-800":"update"===e.change_type?"bg-blue-100 text-blue-800":"delete"===e.change_type?"bg-red-100 text-red-800":"status_change"===e.change_type?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"),children:e.change_type}),pe.jsx("p",{className:"text-sm text-gray-600 mt-1",children:e.reason}),e.fields_changed.length>0&&pe.jsxs("div",{className:"mt-2",children:[pe.jsx("p",{className:"text-xs text-gray-500",children:"Fields changed:"}),pe.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:e.fields_changed.map((e,t)=>pe.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:e.field},t))})]})]}),pe.jsxs("div",{className:"text-right text-xs text-gray-500",children:[pe.jsx("div",{children:S(e.timestamp)}),pe.jsx("div",{children:e.changed_by}),e.automated&&pe.jsx("div",{className:"text-orange-600",children:"Automated"})]})]})},e.log_id)),0===b.length&&pe.jsxs("div",{className:"text-center py-8 text-gray-500",children:[pe.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("p",{className:"mt-2",children:"No audit logs found"})]})]})]})]})})]}),w&&pe.jsx(Ue,{leadId:t.lead_id,leadName:t.full_name,leadEmail:t.email,onClose:()=>_(!1),onSuccess:()=>{C(),c("activities")}}),pe.jsx(ze,{isOpen:v,onClose:()=>N(!1),onSave:async(e,s,a,r)=>{try{if(await Oe.updateLead(t.lead_id,{status:e},"system",s,{comments:a}),r.trim())try{await Oe.addActivity(t.lead_id,{type:"note",subject:`Status change note: ${s}`,notes:r.trim(),timestamp:new Date},t.full_name||`${t.first_name} ${t.last_name}`,t.email,"system")}catch(l){}await C(),t.status=e}catch(mt){throw mt}},currentStatus:t.status,leadName:t.full_name||`${t.first_name} ${t.last_name}`})]})})}function He(e,t=15){const s=e.toLowerCase().trim();if(!s)return[];const a=[];for(let r=1;r<=Math.min(s.length,t);r++)a.push(s.slice(0,r));return a}const Ge=({lead:t,onSave:s,onClose:a})=>{const[r,l]=e.useState({first_name:"",last_name:"",email:"",phone:"",company:"",title:"",status:"new",stage:"awareness",source:"",notes:"",contract_value:0,tags:[],address:{street:"",city:"",state:"",zip:"",country:"USA"}}),[n,i]=e.useState([{id:"basic",title:"Basic Information",icon:D,isOpen:!0},{id:"activities",title:"Activities",icon:G,isOpen:!0},{id:"proposals",title:"Proposals",icon:Q,isOpen:!0},{id:"contracts",title:"Contracts",icon:J,isOpen:!0}]),[c,d]=e.useState([]),[o,m]=e.useState([]),[u,x]=e.useState([]),[h,p]=e.useState({type:"call",subject:"",notes:"",status:"completed",priority:"medium",duration:"",outcome:""}),[b,y]=e.useState({title:"",description:"",status:"draft",amount:"",currency:"USD",valid_until:"",terms:""}),[f,N]=e.useState({title:"",status:"active",amount:"",currency:"USD",start_date:"",end_date:"",terms:"",auto_renew:!1}),[w,_]=e.useState(!1),[C,S]=e.useState(null),[k,L]=e.useState(!1);e.useEffect(()=>{t&&(l({first_name:t.first_name||"",last_name:t.last_name||"",email:t.email||"",phone:t.phone||"",company:t.company||"",title:t.title||"",status:t.status||"new",stage:t.stage||"awareness",source:t.source||"",notes:t.notes||"",contract_value:t.contract_value||0,tags:t.tags||[],address:t.address||{street:"",city:"",state:"",zip:"",country:"USA"}}),T())},[t]);const T=e.useCallback(async()=>{if(t)try{const e=await Oe.getLeadWithSubcollections(t.lead_id);d(e.activities),m(e.proposals),x(e.contracts)}catch(mt){}},[t]),A=(e,t)=>{l(s=>({...s,[e]:t}))},E=async()=>{if(h.subject.trim())if(t)try{const e={type:h.type,subject:h.subject,subject_lower:h.subject.toLowerCase(),notes:h.notes,notes_lower:h.notes.toLowerCase(),duration:h.duration?parseInt(h.duration):void 0,status:h.status,priority:h.priority,outcome:h.outcome||""};await Oe.addActivity(t.lead_id,e,t.full_name,t.email,"Current User");p({type:"call",subject:"",notes:"",status:"completed",priority:"medium",duration:"",outcome:""}),await T()}catch(mt){alert("Failed to add activity. Please check the console for details.")}else alert("Cannot add activity: Lead must be saved first. Please save the lead before adding activities.");else alert("Please enter an activity subject.")},$=async()=>{var e;if(b.title.trim())if(t)try{const s={title:b.title,title_lower:b.title.toLowerCase(),description:b.description,description_lower:null==(e=b.description)?void 0:e.toLowerCase(),status:b.status,amount:b.amount?parseFloat(b.amount):void 0,currency:b.currency,valid_until:b.valid_until?j.fromDate(new Date(b.valid_until)):void 0,terms:b.terms};await Oe.addProposal(t.lead_id,s,t.full_name,t.email,"Current User");y({title:"",description:"",status:"draft",amount:"",currency:"USD",valid_until:"",terms:""}),await T()}catch(mt){alert("Failed to add proposal. Please check the console for details.")}else alert("Cannot add proposal: Lead must be saved first. Please save the lead before adding proposals.");else alert("Please enter a proposal title.")},F=async()=>{if(f.title.trim())if(t)try{const e={...f,title_lower:f.title.toLowerCase(),amount:f.amount?parseFloat(f.amount):void 0,start_date:j.fromDate(new Date(f.start_date)),end_date:j.fromDate(new Date(f.end_date)),created_by:"Current User",search_keywords:[]};await Oe.addContract(t.lead_id,e,t.full_name,t.email,"Current User"),N({title:"",status:"active",amount:"",currency:"USD",start_date:"",end_date:"",terms:"",auto_renew:!1}),T()}catch(mt){}else alert("Cannot add contract: Lead must be saved first. Please save the lead before adding contracts.");else alert("Please enter a contract title.")},R=e=>{if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString()},O=(e,t)=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(e);return pe.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-50",children:pe.jsx("div",{className:"flex items-start justify-center p-4 pt-8",children:pe.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[pe.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[pe.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:t?"Edit Lead":"Add New Lead"}),pe.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-600",children:pe.jsx(P,{className:"h-6 w-6"})})]}),t&&pe.jsxs("div",{className:"p-4 bg-yellow-50 border-b border-yellow-200",children:[pe.jsx("h4",{className:"text-sm font-medium text-yellow-800 mb-2",children:"Debug Info:"}),pe.jsxs("div",{className:"text-xs text-yellow-700",children:[pe.jsxs("p",{children:["Lead ID: ",t.lead_id||"NO LEAD_ID"]}),pe.jsxs("p",{children:["Lead Name: ",t.first_name," ",t.last_name]}),pe.jsxs("p",{children:["Activities Count: ",c.length]}),pe.jsxs("p",{children:["Proposals Count: ",o.length]}),pe.jsxs("p",{children:["Contracts Count: ",u.length]})]})]}),k&&C&&pe.jsx("div",{className:"p-6 bg-green-50 border-b border-green-200",children:pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("div",{className:"flex-shrink-0",children:pe.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:pe.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),pe.jsxs("div",{className:"ml-3",children:[pe.jsx("h3",{className:"text-sm font-medium text-green-800",children:t?"Lead Updated Successfully!":"Lead Created Successfully!"}),pe.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[pe.jsxs("p",{children:[pe.jsx("strong",{children:"Document ID:"})," ",pe.jsx("code",{className:"bg-green-100 px-2 py-1 rounded text-xs font-mono",children:C})]}),pe.jsx("p",{className:"mt-1",children:"You can use this ID to search for the lead in your database."})]}),pe.jsx("div",{className:"mt-3",children:pe.jsx("button",{type:"button",onClick:()=>{L(!1),S(null),a()},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200 transition-colors",children:"Close"})})]})]})}),pe.jsxs("form",{onSubmit:async e=>{e.preventDefault(),_(!0);try{const e=`${r.first_name} ${r.last_name}`,a=r.phone.replace(/\D/g,""),l=function(e){const t=(e.first_name||"").toLowerCase(),s=(e.last_name||"").toLowerCase(),a=`${t} ${s}`.trim(),r=(e.email||"").toLowerCase(),l=(e.phone||"").replace(/\D/g,""),n=(e.company||"").toLowerCase(),i=new Set([...He(t),...He(s),...He(a),...He(r),...He(l),...He(n)]);return Array.from(i)}({first_name:r.first_name,last_name:r.last_name,email:r.email,phone:r.phone,company:r.company}),n={...r,full_name:e,full_name_lower:e.toLowerCase(),email_lower:r.email.toLowerCase(),phone_digits:a,company_lower:r.company.toLowerCase(),updated_at:j.now(),created_at:(null==t?void 0:t.created_at)||j.now(),search_prefixes:l};if(t)await Oe.updateLead(t.lead_id,n,"Current User","Lead updated via enhanced form"),S(t.lead_id),L(!0),s({...t,...n});else{const e=g(De,"leads"),t=await v(e,n),a={...n,lead_id:t.id};S(t.id),L(!0),s(a)}}catch(mt){alert("Failed to save lead. Please try again.")}finally{_(!1)}},className:"p-6",children:[n.map(e=>{const s=e.icon;return pe.jsxs("div",{className:"mb-6",children:[pe.jsxs("button",{type:"button",onClick:()=>{return t=e.id,void i(e=>e.map(e=>e.id===t?{...e,isOpen:!e.isOpen}:e));var t},className:"flex items-center justify-between w-full p-4 text-left bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(s,{className:"h-5 w-5 mr-3 text-gray-600"}),pe.jsx("span",{className:"font-medium text-gray-900",children:e.title}),"activities"===e.id&&c.length>0&&pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:c.length}),"proposals"===e.id&&o.length>0&&pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-green-100 text-green-800 rounded-full",children:o.length}),"contracts"===e.id&&u.length>0&&pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full",children:u.length})]}),e.isOpen?pe.jsx(M,{className:"h-5 w-5 text-gray-600"}):pe.jsx(z,{className:"h-5 w-5 text-gray-600"})]}),e.isOpen&&pe.jsxs("div",{className:"mt-4 p-4 bg-white border border-gray-200 rounded-lg",children:["basic"===e.id&&pe.jsxs("div",{className:"space-y-6",children:[pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name *"}),pe.jsx("input",{type:"text",required:!0,value:r.first_name,onChange:e=>A("first_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name *"}),pe.jsx("input",{type:"text",required:!0,value:r.last_name,onChange:e=>A("last_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),pe.jsx("input",{type:"email",required:!0,value:r.email,onChange:e=>A("email",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Phone"}),pe.jsx("input",{type:"tel",value:r.phone,onChange:e=>A("phone",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Company *"}),pe.jsx("input",{type:"text",required:!0,value:r.company,onChange:e=>A("company",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Job Title"}),pe.jsx("input",{type:"text",value:r.title,onChange:e=>A("title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),pe.jsxs("select",{value:r.status,onChange:e=>A("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"new",children:"New"}),pe.jsx("option",{value:"contacted",children:"Contacted"}),pe.jsx("option",{value:"qualified",children:"Qualified"}),pe.jsx("option",{value:"proposal",children:"Proposal"}),pe.jsx("option",{value:"negotiation",children:"Negotiation"}),pe.jsx("option",{value:"closed-won",children:"Closed Won"}),pe.jsx("option",{value:"closed-lost",children:"Closed Lost"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Source"}),pe.jsx("input",{type:"text",value:r.source,onChange:e=>A("source",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Notes"}),pe.jsx("textarea",{rows:4,value:r.notes,onChange:e=>A("notes",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Add any additional notes about this lead..."})]})]}),"activities"===e.id&&pe.jsxs("div",{className:"space-y-4",children:[pe.jsxs("div",{className:"p-4 rounded-lg "+(t?"bg-blue-50":"bg-gray-50 opacity-60"),children:[pe.jsxs("h4",{className:"font-medium mb-3 "+(t?"text-blue-900":"text-gray-500"),children:["Add New Activity",!t&&pe.jsx("span",{className:"ml-2 text-xs text-gray-400",children:"(Save lead first)"})]}),pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),pe.jsxs("select",{value:h.type,onChange:e=>p(t=>({...t,type:e.target.value})),disabled:!t,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm "+(t?"":"bg-gray-100 cursor-not-allowed"),children:[pe.jsx("option",{value:"call",children:"Call"}),pe.jsx("option",{value:"email",children:"Email"}),pe.jsx("option",{value:"meeting",children:"Meeting"}),pe.jsx("option",{value:"note",children:"Note"}),pe.jsx("option",{value:"task",children:"Task"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subject *"}),pe.jsx("input",{type:"text",value:h.subject,onChange:e=>p(t=>({...t,subject:e.target.value})),disabled:!t,className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm "+(t?"":"bg-gray-100 cursor-not-allowed"),placeholder:"Activity subject"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:h.status,onChange:e=>p(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[pe.jsx("option",{value:"completed",children:"Completed"}),pe.jsx("option",{value:"pending",children:"Pending"}),pe.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration (minutes)"}),pe.jsx("input",{type:"number",value:h.duration,onChange:e=>p(t=>({...t,duration:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"e.g., 30"})]})]}),pe.jsxs("div",{className:"mt-4",children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),pe.jsx("textarea",{rows:3,value:h.notes,onChange:e=>p(t=>({...t,notes:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Activity notes..."})]}),pe.jsxs("button",{type:"button",onClick:E,disabled:!t,className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md "+(t?"text-white bg-blue-600 hover:bg-blue-700":"text-gray-400 bg-gray-300 cursor-not-allowed"),children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Activity"]})]}),pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pe.jsxs("h4",{className:"font-medium text-gray-900",children:["Existing Activities (",c.length,")"]}),pe.jsx("button",{type:"button",onClick:T,className:"text-xs px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded",children:"Reload"})]}),void 0,0===c.length?pe.jsx("p",{className:"text-gray-500 text-sm",children:"No activities yet. Add one above!"}):pe.jsx("div",{className:"space-y-3",children:c.map((e,t)=>pe.jsx("div",{className:"flex items-start justify-between p-3 bg-gray-50 rounded-lg",children:pe.jsxs("div",{className:"flex-1",children:[pe.jsxs("div",{className:"flex items-center mb-1",children:[pe.jsx(G,{className:"h-4 w-4 mr-2 text-blue-600"}),pe.jsx("span",{className:"font-medium text-sm",children:e.subject}),pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:e.type})]}),pe.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.notes}),pe.jsxs("div",{className:"flex items-center text-xs text-gray-500 space-x-4",children:[pe.jsx("span",{children:R(e.timestamp)}),e.duration&&pe.jsxs("span",{children:[e.duration," min"]}),pe.jsx("span",{className:"px-2 py-1 rounded-full "+("completed"===(e.status||"completed")?"bg-green-100 text-green-800":"pending"===(e.status||"completed")?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status||"completed"})]})]})},t))})]})]}),"proposals"===e.id&&pe.jsxs("div",{className:"space-y-4",children:[pe.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[pe.jsx("h4",{className:"font-medium text-green-900 mb-3",children:"Add New Proposal"}),pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),pe.jsx("input",{type:"text",value:b.title,onChange:e=>y(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Proposal title"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:b.status,onChange:e=>y(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[pe.jsx("option",{value:"draft",children:"Draft"}),pe.jsx("option",{value:"sent",children:"Sent"}),pe.jsx("option",{value:"accepted",children:"Accepted"}),pe.jsx("option",{value:"rejected",children:"Rejected"}),pe.jsx("option",{value:"expired",children:"Expired"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),pe.jsx("input",{type:"number",value:b.amount,onChange:e=>y(t=>({...t,amount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"0.00"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),pe.jsxs("select",{value:b.currency,onChange:e=>y(t=>({...t,currency:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[pe.jsx("option",{value:"USD",children:"USD"}),pe.jsx("option",{value:"EUR",children:"EUR"}),pe.jsx("option",{value:"GBP",children:"GBP"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valid Until"}),pe.jsx("input",{type:"date",value:b.valid_until,onChange:e=>y(t=>({...t,valid_until:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),pe.jsxs("div",{className:"mt-4",children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),pe.jsx("textarea",{rows:3,value:b.description,onChange:e=>y(t=>({...t,description:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Proposal description..."})]}),pe.jsxs("button",{type:"button",onClick:$,className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Proposal"]})]}),pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex items-center justify-between mb-3",children:[pe.jsxs("h4",{className:"font-medium text-gray-900",children:["Existing Proposals (",o.length,")"]}),pe.jsx("button",{type:"button",onClick:T,className:"text-xs px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded",children:"Reload"})]}),void 0,0===o.length?pe.jsx("p",{className:"text-gray-500 text-sm",children:"No proposals yet. Add one above!"}):pe.jsx("div",{className:"space-y-3",children:o.map((e,t)=>pe.jsx("div",{className:"flex items-start justify-between p-3 bg-gray-50 rounded-lg",children:pe.jsxs("div",{className:"flex-1",children:[pe.jsxs("div",{className:"flex items-center mb-1",children:[pe.jsx(Q,{className:"h-4 w-4 mr-2 text-green-600"}),pe.jsx("span",{className:"font-medium text-sm",children:e.title}),pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full "+("accepted"===e.status?"bg-green-100 text-green-800":"sent"===e.status?"bg-blue-100 text-blue-800":"rejected"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})]}),e.description&&pe.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.description}),pe.jsxs("div",{className:"flex items-center text-xs text-gray-500 space-x-4",children:[pe.jsx("span",{children:R(e.sent_at||e.created_at)}),(e.amount||e.value)&&pe.jsx("span",{className:"font-medium",children:O(e.amount||e.value,e.currency||"USD")})]})]})},t))})]})]}),"contracts"===e.id&&pe.jsxs("div",{className:"space-y-4",children:[pe.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[pe.jsx("h4",{className:"font-medium text-purple-900 mb-3",children:"Add New Contract"}),pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),pe.jsx("input",{type:"text",value:f.title,onChange:e=>N(t=>({...t,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Contract title"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:f.status,onChange:e=>N(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[pe.jsx("option",{value:"active",children:"Active"}),pe.jsx("option",{value:"expired",children:"Expired"}),pe.jsx("option",{value:"pending",children:"Pending"}),pe.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount"}),pe.jsx("input",{type:"number",value:f.amount,onChange:e=>N(t=>({...t,amount:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"0.00"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),pe.jsxs("select",{value:f.currency,onChange:e=>N(t=>({...t,currency:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",children:[pe.jsx("option",{value:"USD",children:"USD"}),pe.jsx("option",{value:"EUR",children:"EUR"}),pe.jsx("option",{value:"GBP",children:"GBP"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Start Date"}),pe.jsx("input",{type:"date",value:f.start_date,onChange:e=>N(t=>({...t,start_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"End Date"}),pe.jsx("input",{type:"date",value:f.end_date,onChange:e=>N(t=>({...t,end_date:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm"})]})]}),pe.jsxs("div",{className:"mt-4",children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Terms"}),pe.jsx("textarea",{rows:3,value:f.terms,onChange:e=>N(t=>({...t,terms:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm",placeholder:"Contract terms..."})]}),pe.jsx("div",{className:"mt-4",children:pe.jsxs("label",{className:"flex items-center",children:[pe.jsx("input",{type:"checkbox",checked:f.auto_renew,onChange:e=>N(t=>({...t,auto_renew:e.target.checked})),className:"mr-2"}),pe.jsx("span",{className:"text-sm text-gray-700",children:"Auto-renewal"})]})}),pe.jsxs("button",{type:"button",onClick:F,className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Contract"]})]}),pe.jsxs("div",{children:[pe.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Existing Contracts (",u.length,")"]}),0===u.length?pe.jsx("p",{className:"text-gray-500 text-sm",children:"No contracts yet. Add one above!"}):pe.jsx("div",{className:"space-y-3",children:u.map((e,t)=>pe.jsx("div",{className:"flex items-start justify-between p-3 bg-gray-50 rounded-lg",children:pe.jsxs("div",{className:"flex-1",children:[pe.jsxs("div",{className:"flex items-center mb-1",children:[pe.jsx(J,{className:"h-4 w-4 mr-2 text-purple-600"}),pe.jsx("span",{className:"font-medium text-sm",children:e.title||"Untitled Contract"}),pe.jsx("span",{className:"ml-2 px-2 py-1 text-xs rounded-full "+("active"===e.status?"bg-green-100 text-green-800":"expired"===e.status?"bg-red-100 text-red-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status})]}),e.terms&&pe.jsx("p",{className:"text-sm text-gray-600 mb-2",children:e.terms}),pe.jsxs("div",{className:"flex items-center text-xs text-gray-500 space-x-4",children:[pe.jsxs("span",{children:["Start: ",R(e.start_date)]}),pe.jsxs("span",{children:["End: ",R(e.end_date)]}),(e.amount||e.value)&&pe.jsx("span",{className:"font-medium",children:O(e.amount||e.value,e.currency||"USD")})]})]})},t))})]})]})]})]},e.id)}),pe.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t border-gray-200",children:[pe.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500",children:"Cancel"}),pe.jsx("button",{type:"submit",disabled:w,className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50",children:w?pe.jsxs(pe.Fragment,{children:[pe.jsx(U,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):pe.jsxs(pe.Fragment,{children:[pe.jsx(I,{className:"h-4 w-4 mr-2"}),"Save Lead"]})})]})]})]})})})},Qe=12;function Je({onViewLead:t,onEditLead:s}){const[a,r]=e.useState([]),[l,n]=e.useState(!1),[i,c]=e.useState(null),[d,o]=e.useState(1),[m,u]=e.useState(0),[x,h]=e.useState(0),[y,v]=e.useState(null),[N,w]=e.useState(!1),[C,S]=e.useState(!1),[k,L]=e.useState(!1),[P,I]=e.useState({searchTerm:"",status:"",source:"",createdDateFrom:"",createdDateTo:"",updatedDateFrom:"",updatedDateTo:"",assignedTo:""});e.useEffect(()=>{const e=setTimeout(()=>{P.searchTerm||U()?B():q()},500);return()=>clearTimeout(e)},[P,d]);const U=()=>P.status||P.source||P.createdDateFrom||P.createdDateTo||P.updatedDateFrom||P.updatedDateTo||P.assignedTo,q=async(e=1)=>{n(!0),c(null);try{const t=(()=>{const e=[];return P.searchTerm.trim()&&e.push(_("search_prefixes","array-contains",P.searchTerm.toLowerCase().trim())),P.status&&e.push(_("status","==",P.status)),P.source&&e.push(_("source","==",P.source)),P.assignedTo&&e.push(_("assigned_to","==",P.assignedTo)),P.createdDateFrom&&e.push(_("created_at",">=",j.fromDate(new Date(P.createdDateFrom)))),P.createdDateTo&&e.push(_("created_at","<=",j.fromDate(new Date(P.createdDateTo)))),P.updatedDateFrom&&e.push(_("updated_at",">=",j.fromDate(new Date(P.updatedDateFrom)))),P.updatedDateTo&&e.push(_("updated_at","<=",j.fromDate(new Date(P.updatedDateTo)))),e.push(b("created_at","desc")),p(g(De,"leads"),...e)})(),s=(await f(t)).docs.map(e=>({lead_id:e.id,...e.data()})),a=(e-1)*Qe,l=a+Qe,n=s.slice(a,l);r(n),h(s.length),u(Math.ceil(s.length/Qe)),w(e<Math.ceil(s.length/Qe)),S(e>1),o(e)}catch(t){c("Failed to load leads")}finally{n(!1)}},B=e.useCallback(()=>{o(1),q(1)},[P]),M=(e,t)=>{I(s=>({...s,[e]:t}))},V=e=>{e>=1&&e<=m&&q(e)},W=e=>{switch(e.toLowerCase()){case"customer":case"active":case"accepted":return"bg-green-100 text-green-800";case"new":case"draft":case"pending":return"bg-yellow-100 text-yellow-800";case"negotiation":case"sent":return"bg-blue-100 text-blue-800";case"closed":case"rejected":case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},H=e=>{if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString()};return e.useEffect(()=>{q(1)},[]),pe.jsxs("div",{className:"space-y-6",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{children:[pe.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Lead Search"}),pe.jsx("p",{className:"text-gray-600",children:"Search and filter leads with advanced options"})]}),pe.jsxs("button",{onClick:()=>q(d),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[pe.jsx(ee,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),pe.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[pe.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[pe.jsxs("div",{className:"flex-1 relative",children:[pe.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),pe.jsx("input",{type:"text",placeholder:"Search leads by name, email, phone, or company...",value:P.searchTerm,onChange:e=>M("searchTerm",e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),pe.jsxs("button",{onClick:()=>L(!k),className:"flex items-center px-4 py-2 rounded-md transition-colors "+(k||U()?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Filters",U()&&pe.jsx("span",{className:"ml-2 bg-white text-blue-600 rounded-full px-2 py-1 text-xs font-medium",children:Object.values(P).filter(e=>e&&e!==P.searchTerm).length})]})]}),k&&pe.jsxs("div",{className:"border-t pt-4",children:[pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:P.status,onChange:e=>M("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[pe.jsx("option",{value:"",children:"All Statuses"}),pe.jsx("option",{value:"new",children:"New"}),pe.jsx("option",{value:"contacted",children:"Contacted"}),pe.jsx("option",{value:"qualified",children:"Qualified"}),pe.jsx("option",{value:"proposal",children:"Proposal"}),pe.jsx("option",{value:"negotiation",children:"Negotiation"}),pe.jsx("option",{value:"closed",children:"Closed"}),pe.jsx("option",{value:"customer",children:"Customer"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source"}),pe.jsxs("select",{value:P.source,onChange:e=>M("source",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500",children:[pe.jsx("option",{value:"",children:"All Sources"}),pe.jsx("option",{value:"website",children:"Website"}),pe.jsx("option",{value:"referral",children:"Referral"}),pe.jsx("option",{value:"cold_call",children:"Cold Call"}),pe.jsx("option",{value:"trade_show",children:"Trade Show"}),pe.jsx("option",{value:"social_media",children:"Social Media"}),pe.jsx("option",{value:"email_campaign",children:"Email Campaign"}),pe.jsx("option",{value:"linkedin",children:"LinkedIn"}),pe.jsx("option",{value:"google_ads",children:"Google Ads"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned To"}),pe.jsx("input",{type:"text",placeholder:"Enter name...",value:P.assignedTo,onChange:e=>M("assignedTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Created From"}),pe.jsx("input",{type:"date",value:P.createdDateFrom,onChange:e=>M("createdDateFrom",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Created To"}),pe.jsx("input",{type:"date",value:P.createdDateTo,onChange:e=>M("createdDateTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Updated From"}),pe.jsx("input",{type:"date",value:P.updatedDateFrom,onChange:e=>M("updatedDateFrom",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Updated To"}),pe.jsx("input",{type:"date",value:P.updatedDateTo,onChange:e=>M("updatedDateTo",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"})]})]}),pe.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[pe.jsx("button",{onClick:()=>{I({searchTerm:"",status:"",source:"",createdDateFrom:"",createdDateTo:"",updatedDateFrom:"",updatedDateTo:"",assignedTo:""}),o(1)},className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear all filters"}),pe.jsxs("div",{className:"text-sm text-gray-600",children:[x," lead",1!==x?"s":""," found"]})]})]})]}),l?pe.jsxs("div",{className:"flex justify-center items-center py-12",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Loading leads..."})]}):i?pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx("div",{className:"text-red-600 mb-4",children:i}),pe.jsx("button",{onClick:()=>q(d),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]}):pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(e=>{return pe.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[pe.jsxs("div",{className:"flex items-start justify-between mb-4",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(D,{className:"h-5 w-5 text-gray-400 mr-2"}),pe.jsxs("div",{children:[pe.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.full_name||`${e.first_name} ${e.last_name}`}),pe.jsx("p",{className:"text-sm text-gray-500",children:e.email})]})]}),pe.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${W(e.status)}`,children:e.status})]}),pe.jsxs("div",{className:"space-y-2 mb-4",children:[e.phone&&pe.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[pe.jsx(T,{className:"h-4 w-4 mr-2"}),e.phone]}),e.company&&pe.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[pe.jsx(A,{className:"h-4 w-4 mr-2"}),e.company]})]}),pe.jsxs("div",{className:"space-y-1 mb-4 text-xs text-gray-500",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),"Created: ",H(e.created_at)]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),"Updated: ",H(e.updated_at)]})]}),pe.jsx("div",{className:"mb-4",children:pe.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono text-gray-500",children:["ID: ",e.lead_id]})}),e.contract_value>0&&pe.jsx("div",{className:"text-sm font-medium text-green-600 mb-4",children:(a=e.contract_value,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a))}),pe.jsxs("div",{className:"flex space-x-2",children:[pe.jsxs("button",{onClick:()=>t(e),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",children:[pe.jsx($,{className:"h-4 w-4 mr-1"}),"View"]}),pe.jsxs("button",{onClick:()=>s(e),className:"flex-1 flex items-center justify-center px-3 py-2 bg-gray-600 text-white text-sm rounded-md hover:bg-gray-700 transition-colors",children:[pe.jsx(F,{className:"h-4 w-4 mr-1"}),"Edit"]})]})]},e.lead_id);var a})}),m>1&&pe.jsxs("div",{className:"flex items-center justify-between bg-white px-6 py-3 rounded-lg shadow",children:[pe.jsx("div",{className:"flex items-center text-sm text-gray-700",children:pe.jsxs("span",{children:["Showing ",(d-1)*Qe+1," to ",Math.min(d*Qe,x)," of ",x," results"]})}),pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsxs("button",{onClick:()=>V(d-1),disabled:!C,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[pe.jsx(te,{className:"h-4 w-4 mr-1"}),"Previous"]}),pe.jsxs("div",{className:"flex items-center space-x-1",children:[Array.from({length:Math.min(5,m)},(e,t)=>{const s=t+1;return pe.jsx("button",{onClick:()=>V(s),className:"px-3 py-2 text-sm font-medium rounded-md "+(d===s?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:s},s)}),m>5&&pe.jsxs(pe.Fragment,{children:[pe.jsx("span",{className:"px-2 text-gray-500",children:"..."}),pe.jsx("button",{onClick:()=>V(m),className:"px-3 py-2 text-sm font-medium rounded-md "+(d===m?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:m})]})]}),pe.jsxs("button",{onClick:()=>V(d+1),disabled:!N,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",pe.jsx(z,{className:"h-4 w-4 ml-1"})]})]})]})]})]})}const Ke=[{value:"first_name",label:"First Name",icon:D,type:"text"},{value:"last_name",label:"Last Name",icon:D,type:"text"},{value:"email",label:"Email",icon:Y,type:"email"},{value:"phone",label:"Phone",icon:T,type:"tel"},{value:"company",label:"Company",icon:A,type:"text"},{value:"status",label:"Status",icon:ae,type:"select"},{value:"source",label:"Source",icon:ae,type:"select"},{value:"contract_value",label:"Contract Value",icon:Z,type:"number"},{value:"created_at",label:"Created Date",icon:E,type:"date"},{value:"updated_at",label:"Updated Date",icon:E,type:"date"}],Ye=[{value:"equals",label:"Equals"},{value:"contains",label:"Contains"},{value:"starts_with",label:"Starts With"},{value:"ends_with",label:"Ends With"},{value:"not_equals",label:"Not Equals"},{value:"not_contains",label:"Not Contains"}],Xe=["new","contacted","qualified","proposal","negotiation","closed","customer"],Ze=["website","referral","cold_call","trade_show","social_media","email_campaign","linkedin","google_ads"];function et({onApplyFilters:t,onClearFilters:s,isOpen:a,onClose:r}){const[l,n]=e.useState([{id:"group-1",conditions:[{id:"condition-1",field:"first_name",operator:"contains",value:"",enabled:!0}],operator:"AND",enabled:!0}]),[i,c]=e.useState(!1),d=(e,t,s)=>{n(a=>a.map(a=>a.id===e?{...a,conditions:a.conditions.map(e=>e.id===t?{...e,...s}:e)}:a))},o=()=>l.reduce((e,t)=>t.enabled?e+t.conditions.filter(e=>e.enabled&&e.value.trim()).length:e,0);return a?pe.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:pe.jsxs("div",{className:"flex items-start justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[pe.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:r}),pe.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full",children:[pe.jsx("div",{className:"bg-white px-6 py-4 border-b border-gray-200",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(R,{className:"h-6 w-6 text-blue-600 mr-3"}),pe.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Advanced Filters"}),o()>0&&pe.jsxs("span",{className:"ml-3 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[o()," active"]})]}),pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsxs("button",{onClick:()=>c(!i),className:"text-sm text-gray-500 hover:text-gray-700",children:[i?"Collapse":"Expand"," All"]}),pe.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:pe.jsx(P,{className:"h-6 w-6"})})]})]})}),pe.jsx("div",{className:"bg-white px-6 py-4 max-h-96 overflow-y-auto",children:pe.jsxs("div",{className:"space-y-6",children:[l.map((e,t)=>pe.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[pe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("input",{type:"checkbox",checked:e.enabled,onChange:()=>{return t=e.id,void n(e=>e.map(e=>e.id===t?{...e,enabled:!e.enabled}:e));var t},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),pe.jsxs("span",{className:"ml-2 text-sm font-medium text-gray-700",children:["Filter Group ",t+1]})]}),pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsxs("select",{value:e.operator,onChange:t=>{return s=e.id,a=t.target.value,void n(e=>e.map(e=>e.id===s?{...e,operator:a}:e));var s,a},className:"text-sm border border-gray-300 rounded-md px-2 py-1",disabled:!e.enabled,children:[pe.jsx("option",{value:"AND",children:"AND"}),pe.jsx("option",{value:"OR",children:"OR"})]}),l.length>1&&pe.jsx("button",{onClick:()=>{return t=e.id,void(l.length>1&&n(l.filter(e=>e.id!==t)));var t},className:"text-red-600 hover:text-red-800",children:pe.jsx(se,{className:"h-4 w-4"})})]})]}),pe.jsxs("div",{className:"space-y-3",children:[e.conditions.map((t,s)=>{const a=(r=t.field,Ke.find(e=>e.value===r)||Ke[0]);var r;const i=(e=>{switch(e){case"status":return Xe;case"source":return Ze;default:return[]}})(t.field),c=a.icon;return pe.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-md",children:[pe.jsx("input",{type:"checkbox",checked:t.enabled,onChange:()=>{return s=e.id,a=t.id,void d(s,a,{enabled:!(null==(n=null==(r=l.find(e=>e.id===s))?void 0:r.conditions.find(e=>e.id===a))?void 0:n.enabled)});var s,a,r,n},className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsx(c,{className:"h-4 w-4 text-gray-500"}),pe.jsx("select",{value:t.field,onChange:s=>d(e.id,t.id,{field:s.target.value}),className:"text-sm border border-gray-300 rounded-md px-2 py-1",disabled:!t.enabled,children:Ke.map(e=>pe.jsx("option",{value:e.value,children:e.label},e.value))})]}),pe.jsx("select",{value:t.operator,onChange:s=>d(e.id,t.id,{operator:s.target.value}),className:"text-sm border border-gray-300 rounded-md px-2 py-1",disabled:!t.enabled,children:Ye.map(e=>pe.jsx("option",{value:e.value,children:e.label},e.value))}),pe.jsx("div",{className:"flex-1",children:i.length>0?pe.jsxs("select",{value:t.value,onChange:s=>d(e.id,t.id,{value:s.target.value}),className:"w-full text-sm border border-gray-300 rounded-md px-2 py-1",disabled:!t.enabled,children:[pe.jsxs("option",{value:"",children:["Select ",a.label]}),i.map(e=>pe.jsx("option",{value:e,children:e},e))]}):pe.jsx("input",{type:a.type,value:t.value,onChange:s=>d(e.id,t.id,{value:s.target.value}),placeholder:`Enter ${a.label.toLowerCase()}`,className:"w-full text-sm border border-gray-300 rounded-md px-2 py-1",disabled:!t.enabled})}),e.conditions.length>1&&pe.jsx("button",{onClick:()=>{return s=e.id,a=t.id,void n(e=>e.map(e=>e.id===s?{...e,conditions:e.conditions.filter(e=>e.id!==a)}:e));var s,a},className:"text-red-600 hover:text-red-800",children:pe.jsx(P,{className:"h-4 w-4"})}),s<e.conditions.length-1&&pe.jsx("span",{className:"text-sm text-gray-500 font-medium",children:e.operator})]},t.id)}),pe.jsxs("button",{onClick:()=>{return t=e.id,void n(e=>e.map(e=>e.id===t?{...e,conditions:[...e.conditions,{id:`condition-${Date.now()}`,field:"first_name",operator:"contains",value:"",enabled:!0}]}:e));var t},className:"w-full flex items-center justify-center px-3 py-2 border border-dashed border-gray-300 rounded-md text-sm text-gray-600 hover:text-gray-800 hover:border-gray-400",disabled:!e.enabled,children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Condition"]})]})]},e.id)),pe.jsxs("button",{onClick:()=>{const e={id:`group-${Date.now()}`,conditions:[{id:`condition-${Date.now()}`,field:"first_name",operator:"contains",value:"",enabled:!0}],operator:"AND",enabled:!0};n([...l,e])},className:"w-full flex items-center justify-center px-4 py-3 border border-dashed border-blue-300 rounded-lg text-sm text-blue-600 hover:text-blue-800 hover:border-blue-400",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Filter Group"]})]})}),pe.jsxs("div",{className:"bg-gray-50 px-6 py-4 flex items-center justify-between",children:[pe.jsx("button",{onClick:()=>{n([{id:"group-1",conditions:[{id:"condition-1",field:"first_name",operator:"contains",value:"",enabled:!0}],operator:"AND",enabled:!0}]),s()},className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All Filters"}),pe.jsxs("div",{className:"flex items-center space-x-3",children:[pe.jsx("button",{onClick:r,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50",children:"Cancel"}),pe.jsx("button",{onClick:()=>{const e=l.filter(e=>e.enabled);t(e)},className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700",children:"Apply Filters"})]})]})]})]})}):null}class tt{static async filterLeads(e,t=20,s){try{const s=g(De,"leads"),a=this.buildQueryConstraints(e);if(0===a.length){const e=p(s,b("created_at","desc"),y(t)),a=await f(e);return{leads:this.mapDocsToLeads(a.docs),totalCount:a.size,hasMore:a.size===t}}const r=p(s,...a,b("created_at","desc"),y(2*t)),l=await f(r);let n=this.mapDocsToLeads(l.docs);n=this.postProcessResults(n,e);const i=n.slice(0,t);return{leads:i,totalCount:i.length,hasMore:n.length>t}}catch(mt){throw new Error("Failed to filter leads")}}static buildQueryConstraints(e){const t=[],s=e.filter(e=>e.enabled);if(0===s.length)return t;if(1===s.length){const e=s[0],a=this.buildGroupConstraints(e);t.push(...a)}else{const e=s.map(e=>{const t=this.buildGroupConstraints(e);return t.length>1?C(...t):t[0]});e.length>0&&t.push(C(...e))}return t}static buildGroupConstraints(e){const t=[],s=e.conditions.filter(e=>e.enabled&&""!==e.value.trim());if(0===s.length)return t;const a=s.filter(e=>["first_name","last_name","email","company"].includes(e.field)&&["contains","ends_with"].includes(e.operator)),r=s.filter(e=>!(["first_name","last_name","email","company"].includes(e.field)&&["contains","ends_with"].includes(e.operator)));if(a.length>0){const e=a.map(e=>e.value.toLowerCase());e.length>0&&t.push(_("search_prefixes","array-contains",e[0]))}const l=r.map(e=>this.buildConditionConstraint(e));return l.length>0&&("OR"===e.operator&&l.length>1?t.push(S(...l)):t.push(...l)),t}static buildConditionConstraint(e){const{field:t,operator:s,value:a}=e;switch(t){case"first_name":return this.buildTextConstraint("first_name_lower",s,a.toLowerCase());case"last_name":return this.buildTextConstraint("last_name_lower",s,a.toLowerCase());case"email":return this.buildTextConstraint("email_lower",s,a.toLowerCase());case"phone":return this.buildPhoneConstraint(s,a);case"company":return this.buildTextConstraint("company_lower",s,a.toLowerCase());case"status":return this.buildExactConstraint("status",s,a);case"source":return this.buildExactConstraint("source",s,a);case"contract_value":return this.buildNumberConstraint("contract_value",s,parseFloat(a));case"created_at":return this.buildDateConstraint("created_at",s,new Date(a));case"updated_at":return this.buildDateConstraint("updated_at",s,new Date(a));default:throw new Error(`Unsupported field: ${t}`)}}static buildTextConstraint(e,t,s){switch(t){case"equals":return _(e,"==",s);case"contains":case"ends_with":case"not_contains":return _("search_prefixes","array-contains",s);case"starts_with":return _(e,">=",s).where(e,"<=",s+"");case"not_equals":return _(e,"!=",s);default:throw new Error(`Unsupported operator: ${t}`)}}static buildPhoneConstraint(e,t){const s=t.replace(/\D/g,""),a="phone_digits";switch(e){case"equals":return _(a,"==",s);case"contains":case"starts_with":case"not_contains":return _(a,">=",s).where(a,"<=",s+"");case"ends_with":return _("search_prefixes","array-contains",s);case"not_equals":return _(a,"!=",s);default:throw new Error(`Unsupported operator: ${e}`)}}static buildExactConstraint(e,t,s){switch(t){case"equals":case"contains":default:return _(e,"==",s);case"not_equals":case"not_contains":return _(e,"!=",s)}}static buildNumberConstraint(e,t,s){switch(t){case"equals":case"contains":default:return _(e,"==",s);case"not_equals":case"not_contains":return _(e,"!=",s)}}static buildDateConstraint(e,t,s){const a=j.fromDate(s);switch(t){case"equals":case"contains":default:return _(e,"==",a);case"not_equals":case"not_contains":return _(e,"!=",a)}}static mapDocsToLeads(e){return e.map(e=>({lead_id:e.id,...e.data()}))}static postProcessResults(e,t){return e.filter(e=>t.every(t=>{if(!t.enabled)return!0;const s=t.conditions.filter(e=>e.enabled&&""!==e.value.trim());if(0===s.length)return!0;const a=s.filter(e=>["first_name","last_name","email","company"].includes(e.field)&&["contains","ends_with"].includes(e.operator)),r=s.filter(e=>!(["first_name","last_name","email","company"].includes(e.field)&&["contains","ends_with"].includes(e.operator)));let l=!0;if(a.length>0){const s=e.search_prefixes||[];l="AND"===t.operator?a.every(e=>s.includes(e.value.toLowerCase())):a.some(e=>s.includes(e.value.toLowerCase()))}const n=r.map(t=>this.evaluateCondition(e,t));let i=!0;return r.length>0&&(i="OR"===t.operator?n.some(e=>e):n.every(e=>e)),a.length>0&&r.length>0?"AND"===t.operator?l&&i:l||i:l&&i}))}static evaluateCondition(e,t){var s,a,r,l;const{field:n,operator:i,value:c}=t;let d;switch(n){case"first_name":d=(null==(s=e.first_name)?void 0:s.toLowerCase())||"";break;case"last_name":d=(null==(a=e.last_name)?void 0:a.toLowerCase())||"";break;case"email":d=(null==(r=e.email)?void 0:r.toLowerCase())||"";break;case"phone":d=e.phone_digits||"";break;case"company":d=(null==(l=e.company)?void 0:l.toLowerCase())||"";break;case"status":d=e.status||"";break;case"source":d=e.source||"";break;case"contract_value":d=e.contract_value||0;break;case"created_at":d=e.created_at;break;case"updated_at":d=e.updated_at;break;default:return!1}const o="contract_value"===n?parseFloat(c):c.toLowerCase();switch(i){case"equals":return d===o;case"contains":return String(d).includes(String(o));case"starts_with":return String(d).startsWith(String(o));case"ends_with":return String(d).endsWith(String(o));case"not_equals":return d!==o;case"not_contains":return!String(d).includes(String(o));default:return!1}}}const st=12;function at({onViewLead:t,onEditLead:s}){const[a,r]=e.useState([]),[l,n]=e.useState(!1),[i,c]=e.useState(null),[d,o]=e.useState(1),[m,u]=e.useState(0),[x,h]=e.useState(0),[g,p]=e.useState(!1),[b,y]=e.useState(!1),[f,j]=e.useState(""),[v,N]=e.useState(!1),[w,_]=e.useState([]),[C,S]=e.useState(!1);e.useEffect(()=>{const e=setTimeout(()=>{f||C?L():k()},500);return()=>clearTimeout(e)},[f,w,d]);const k=async()=>{n(!0),c(null);try{const e=await tt.filterLeads([],st);r(e.leads),h(e.totalCount),u(Math.ceil(e.totalCount/st)),p(e.hasMore),y(d>1)}catch(e){c("Failed to load leads")}finally{n(!1)}},L=e.useCallback(async()=>{n(!0),c(null);try{let e;if(C)e=await tt.filterLeads(w,st);else if(f.trim()){const t=[{id:"search-group",conditions:[{id:"search-condition",field:"first_name",operator:"contains",value:f,enabled:!0}],operator:"OR",enabled:!0}];e=await tt.filterLeads(t,st)}else e=await tt.filterLeads([],st);r(e.leads),h(e.totalCount),u(Math.ceil(e.totalCount/st)),p(e.hasMore),y(d>1)}catch(e){c("Search failed")}finally{n(!1)}},[f,w,C,d]),$=e=>{_(e),S(e.length>0&&e.some(e=>e.enabled&&e.conditions.some(e=>e.enabled&&""!==e.value.trim()))),o(1)},F=()=>{_([]),S(!1),j(""),o(1)},I=e=>{e>=1&&e<=m&&o(e)},U=e=>{switch(e.toLowerCase()){case"customer":case"active":case"accepted":return"bg-green-100 text-green-800";case"new":case"draft":case"pending":return"bg-yellow-100 text-yellow-800";case"negotiation":case"sent":return"bg-blue-100 text-blue-800";case"closed":case"rejected":case"lost":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},q=e=>{if(!e)return"N/A";return(e.toDate?e.toDate():new Date(e)).toLocaleDateString()},B=()=>w.reduce((e,t)=>t.enabled?e+t.conditions.filter(e=>e.enabled&&e.value.trim()).length:e,0);return e.useEffect(()=>{k()},[]),pe.jsxs("div",{className:"space-y-6",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{children:[pe.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Advanced Lead Search"}),pe.jsx("p",{className:"text-gray-600",children:"Search and filter leads with complex conditions"})]}),pe.jsxs("div",{className:"flex items-center space-x-3",children:[pe.jsxs("button",{onClick:()=>L(),className:"flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:[pe.jsx(ee,{className:"h-4 w-4 mr-2"}),"Refresh"]}),pe.jsxs("button",{onClick:()=>N(!0),className:"flex items-center px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors",children:[pe.jsx(re,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),pe.jsxs("div",{className:"bg-white p-6 rounded-lg shadow",children:[pe.jsxs("div",{className:"flex items-center space-x-4",children:[pe.jsxs("div",{className:"flex-1 relative",children:[pe.jsx(O,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),pe.jsx("input",{type:"text",placeholder:"Search leads by name, email, phone, or company...",value:f,onChange:e=>j(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),f&&pe.jsx("button",{onClick:()=>j(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:pe.jsx(P,{className:"h-4 w-4"})})]}),pe.jsxs("button",{onClick:()=>N(!0),className:"flex items-center px-4 py-2 rounded-md transition-colors "+(C?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Advanced Filters",B()>0&&pe.jsx("span",{className:"ml-2 bg-white text-blue-600 rounded-full px-2 py-1 text-xs font-medium",children:B()})]})]}),C&&pe.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Active Filters:"}),pe.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((e,t)=>e.enabled&&e.conditions.filter(e=>e.enabled&&e.value.trim()).map((s,a)=>pe.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[s.field,": ",s.value,pe.jsx("button",{onClick:()=>{const e=[...w];e[t].conditions[a].enabled=!1,$(e)},className:"ml-2 text-blue-600 hover:text-blue-800",children:pe.jsx(P,{className:"h-3 w-3"})})]},`${e.id}-${s.id}`)))})]}),pe.jsx("button",{onClick:F,className:"text-sm text-gray-600 hover:text-gray-800",children:"Clear All"})]})})]}),l?pe.jsxs("div",{className:"flex justify-center items-center py-12",children:[pe.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Searching leads..."})]}):i?pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx("div",{className:"text-red-600 mb-4",children:i}),pe.jsx("button",{onClick:()=>L(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Retry"})]}):pe.jsxs(pe.Fragment,{children:[pe.jsx("div",{className:"bg-white p-4 rounded-lg shadow",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"text-sm text-gray-600",children:["Found ",x," lead",1!==x?"s":"",C&&` with ${B()} active filter${1!==B()?"s":""}`]}),pe.jsxs("div",{className:"text-sm text-gray-500",children:["Page ",d," of ",m]})]})}),pe.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:a.map(e=>{return pe.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow",children:[pe.jsxs("div",{className:"flex items-start justify-between mb-4",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(D,{className:"h-5 w-5 text-gray-400 mr-2"}),pe.jsxs("div",{children:[pe.jsx("h3",{className:"font-semibold text-gray-900 truncate",children:e.full_name||`${e.first_name} ${e.last_name}`}),pe.jsx("p",{className:"text-sm text-gray-500",children:e.email})]})]}),pe.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${U(e.status)}`,children:e.status})]}),pe.jsxs("div",{className:"space-y-2 mb-4",children:[e.phone&&pe.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[pe.jsx(T,{className:"h-4 w-4 mr-2"}),e.phone]}),e.company&&pe.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[pe.jsx(A,{className:"h-4 w-4 mr-2"}),e.company]})]}),pe.jsxs("div",{className:"space-y-1 mb-4 text-xs text-gray-500",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),"Created: ",q(e.created_at)]}),pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(E,{className:"h-3 w-3 mr-1"}),"Updated: ",q(e.updated_at)]})]}),pe.jsx("div",{className:"mb-4",children:pe.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono text-gray-500",children:["ID: ",e.lead_id]})}),e.contract_value>0&&pe.jsx("div",{className:"text-sm font-medium text-green-600 mb-4",children:(a=e.contract_value,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(a))}),pe.jsxs("div",{className:"flex space-x-2",children:[pe.jsxs("button",{onClick:()=>t(e),className:"flex-1 flex items-center justify-center px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",children:[pe.jsx(D,{className:"h-4 w-4 mr-1"}),"View"]}),pe.jsxs("button",{onClick:()=>s(e),className:"flex-1 flex items-center justify-center px-3 py-2 bg-gray-600 text-white text-sm rounded-md hover:bg-gray-700 transition-colors",children:[pe.jsx(ae,{className:"h-4 w-4 mr-1"}),"Edit"]})]})]},e.lead_id);var a})}),m>1&&pe.jsxs("div",{className:"flex items-center justify-between bg-white px-6 py-3 rounded-lg shadow",children:[pe.jsx("div",{className:"flex items-center text-sm text-gray-700",children:pe.jsxs("span",{children:["Showing ",(d-1)*st+1," to ",Math.min(d*st,x)," of ",x," results"]})}),pe.jsxs("div",{className:"flex items-center space-x-2",children:[pe.jsxs("button",{onClick:()=>I(d-1),disabled:!b,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:[pe.jsx(te,{className:"h-4 w-4 mr-1"}),"Previous"]}),pe.jsxs("div",{className:"flex items-center space-x-1",children:[Array.from({length:Math.min(5,m)},(e,t)=>{const s=t+1;return pe.jsx("button",{onClick:()=>I(s),className:"px-3 py-2 text-sm font-medium rounded-md "+(d===s?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:s},s)}),m>5&&pe.jsxs(pe.Fragment,{children:[pe.jsx("span",{className:"px-2 text-gray-500",children:"..."}),pe.jsx("button",{onClick:()=>I(m),className:"px-3 py-2 text-sm font-medium rounded-md "+(d===m?"bg-blue-600 text-white":"text-gray-700 bg-white border border-gray-300 hover:bg-gray-50"),children:m})]})]}),pe.jsxs("button",{onClick:()=>I(d+1),disabled:!g,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed",children:["Next",pe.jsx(z,{className:"h-4 w-4 ml-1"})]})]})]})]}),pe.jsx(et,{isOpen:v,onClose:()=>N(!1),onApplyFilters:$,onClearFilters:F})]})}const rt=new class{async searchSubcollections(e,t={},s={}){const{limit:a=20}=s;try{const r=[];let l=s.lastDoc;const n="all"!==t.type&&t.type?[t.type+"s"]:["activities","proposals","contracts"];for(const c of n){const i=await this.searchInSubcollection(c,e,t,{...s,limit:Math.ceil(a/n.length)});r.push(...i.results),l=i.lastDoc}r.sort((e,t)=>e.searchScore&&t.searchScore&&e.searchScore!==t.searchScore?t.searchScore-e.searchScore:t.timestamp.getTime()-e.timestamp.getTime());const i=r.slice(0,a);return{results:i,lastDoc:i.length>0?void 0:l}}catch(mt){return{results:[]}}}async searchInSubcollection(e,t,s,a){const r=t.toLowerCase().trim(),l=[];try{const t=await f(g(De,"leads"));for(const n of t.docs){const t=n.data(),i=n.id;if(!s.leadId||i===s.leadId)try{const n=g(De,"leads",i,e);let c=p(n);const d=this.buildSearchConstraints(e,r,s);d.length>0&&(c=p(n,...d));const o=this.getSortField(e,a.sortBy),m=a.sortOrder||"desc";c=p(c,b(o,m)),a.limit&&(c=p(c,y(a.limit)));(await f(c)).docs.forEach(a=>{const n=a.data();if(!this.matchesFilters(n,s,e))return;const c=this.calculateSearchScore(n,r,e);if(c>0){const s={id:a.id,type:e.slice(0,-1),leadId:i,leadName:t.full_name||`${t.first_name} ${t.last_name}`,leadEmail:t.email,data:n,timestamp:this.getTimestamp(n,e),searchScore:c};l.push(s)}})}catch(mt){}}return{results:l}}catch(mt){return{results:[]}}}buildSearchConstraints(e,t,s){const a=[];if(t)switch(e){case"activities":case"proposals":case"contracts":a.push(_("search_keywords","array-contains-any",[t]))}if(s.status&&a.push(_("status","==",s.status)),s.createdBy&&a.push(_("created_by","==",s.createdBy)),s.dateFrom){const t=this.getTimestampField(e);a.push(_(t,">=",j.fromDate(s.dateFrom)))}if(s.dateTo){const t=this.getTimestampField(e);a.push(_(t,"<=",j.fromDate(s.dateTo)))}return a}getTimestampField(e){switch(e){case"activities":default:return"timestamp";case"proposals":return"created_at";case"contracts":return"start_date"}}getSortField(e,t){if(t)return t;switch(e){case"activities":default:return"timestamp";case"proposals":return"created_at";case"contracts":return"start_date"}}getTimestamp(e,t){const s=e[this.getTimestampField(t)];return s&&s.toDate?s.toDate():s?new Date(s):new Date}matchesFilters(e,t,s){return!0}calculateSearchScore(e,t,s){let a=0;const r=t.toLowerCase();switch(s){case"activities":e.subject&&e.subject.toLowerCase().includes(r)&&(a+=10),e.notes&&e.notes.toLowerCase().includes(r)&&(a+=5),e.type&&e.type.toLowerCase().includes(r)&&(a+=3);break;case"proposals":e.title&&e.title.toLowerCase().includes(r)&&(a+=10),e.description&&e.description.toLowerCase().includes(r)&&(a+=5),e.status&&e.status.toLowerCase().includes(r)&&(a+=3);break;case"contracts":e.title&&e.title.toLowerCase().includes(r)&&(a+=10),e.terms&&e.terms.toLowerCase().includes(r)&&(a+=5),e.type&&e.type.toLowerCase().includes(r)&&(a+=3)}if(e.search_keywords&&Array.isArray(e.search_keywords)){a+=2*e.search_keywords.filter(e=>e.toLowerCase().includes(r)).length}return a}async getSearchSuggestions(e,t=10){const s=new Set,a=e.toLowerCase().trim();try{const e=["activities","proposals","contracts"];for(const r of e){const e=await f(g(De,"leads"));for(const l of e.docs.slice(0,10))try{const e=g(De,"leads",l.id,r);(await f(p(e,t(5)))).docs.forEach(e=>{const t=e.data();this.getSuggestionFields(r).forEach(e=>{if(t[e]){t[e].toString().toLowerCase().includes(a)&&s.add(t[e])}})})}catch(mt){}}return Array.from(s).slice(0,t)}catch(mt){return[]}}getSuggestionFields(e){switch(e){case"activities":return["subject","notes","type"];case"proposals":return["title","description","status"];case"contracts":return["title","terms","type"];default:return[]}}};function lt({onResultClick:t,className:s=""}){const[a,r]=e.useState(""),[l,n]=e.useState([]),[i,c]=e.useState(!1),[d,o]=e.useState([]),[m,u]=e.useState(!1),[x,h]=e.useState(!1),[g,p]=e.useState({type:"all"}),[b,y]=e.useState(!1),[f,j]=e.useState(void 0),v=e.useCallback(nt(async(e,t)=>{if(!e.trim())return n([]),void y(!1);c(!0);try{const s=await rt.searchSubcollections(e,t,{limit:20});n(s.results),j(s.lastDoc),y(20===s.results.length)}catch(mt){n([])}finally{c(!1)}},300),[]),N=e.useCallback(nt(async e=>{if(e.length<2)o([]);else try{const t=await rt.getSearchSuggestions(e,8);o(t)}catch(mt){o([])}},200),[]);e.useEffect(()=>{v(a,g)},[a,g,v]),e.useEffect(()=>{N(a)},[a,N]);const w=e=>{r(e),h(e.length>=2)},_=(e,t)=>{p(s=>({...s,[e]:t}))},C=e=>{switch(e){case"activity":return pe.jsx(G,{className:"h-4 w-4"});case"proposal":default:return pe.jsx(Q,{className:"h-4 w-4"});case"contract":return pe.jsx(J,{className:"h-4 w-4"})}},S=e=>{switch(e){case"activity":return"bg-blue-100 text-blue-800";case"proposal":return"bg-green-100 text-green-800";case"contract":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}};return pe.jsxs("div",{className:`space-y-4 ${s}`,children:[pe.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[pe.jsxs("div",{className:"flex items-center justify-between mb-4",children:[pe.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Search Subcollections"}),pe.jsxs("button",{onClick:()=>u(!m),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+(m?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Filters",Object.values(g).some(e=>e&&"all"!==e)&&pe.jsx("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:Object.values(g).filter(e=>e&&"all"!==e).length})]})]}),pe.jsxs("div",{className:"relative",children:[pe.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:pe.jsx(O,{className:"h-5 w-5 text-gray-400"})}),pe.jsx("input",{type:"text",value:a,onChange:e=>w(e.target.value),onFocus:()=>h(a.length>=2),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500",placeholder:"Search activities, proposals, contracts..."}),i&&pe.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:pe.jsx(le,{className:"h-4 w-4 animate-spin text-gray-400"})})]}),x&&d.length>0&&pe.jsx("div",{className:"mt-2 bg-white border border-gray-200 rounded-md shadow-lg z-10",children:d.map((e,t)=>pe.jsx("button",{onClick:()=>{w(e),h(!1)},className:"w-full text-left px-3 py-2 hover:bg-gray-50 border-b border-gray-100 last:border-b-0",children:pe.jsx("span",{className:"text-sm text-gray-700",children:e})},t))})]}),m&&pe.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),pe.jsxs("select",{value:g.type||"all",onChange:e=>_("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"all",children:"All Types"}),pe.jsx("option",{value:"activity",children:"Activities"}),pe.jsx("option",{value:"proposal",children:"Proposals"}),pe.jsx("option",{value:"contract",children:"Contracts"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:g.status||"",onChange:e=>_("status",e.target.value||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"All Statuses"}),pe.jsx("option",{value:"completed",children:"Completed"}),pe.jsx("option",{value:"pending",children:"Pending"}),pe.jsx("option",{value:"active",children:"Active"}),pe.jsx("option",{value:"draft",children:"Draft"}),pe.jsx("option",{value:"sent",children:"Sent"}),pe.jsx("option",{value:"accepted",children:"Accepted"}),pe.jsx("option",{value:"rejected",children:"Rejected"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date From"}),pe.jsx("input",{type:"date",value:g.dateFrom?g.dateFrom.toISOString().split("T")[0]:"",onChange:e=>_("dateFrom",e.target.value?new Date(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date To"}),pe.jsx("input",{type:"date",value:g.dateTo?g.dateTo.toISOString().split("T")[0]:"",onChange:e=>_("dateTo",e.target.value?new Date(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-blue-500"})]})]}),pe.jsx("div",{className:"mt-4 flex justify-end",children:pe.jsxs("button",{onClick:()=>{p({type:"all"})},className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[pe.jsx(P,{className:"h-4 w-4 mr-2"}),"Clear Filters"]})})]}),pe.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[a&&pe.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Search Results",l.length>0&&pe.jsxs("span",{className:"ml-2 text-sm font-normal text-gray-500",children:["(",l.length," found)"]})]}),i&&pe.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[pe.jsx(le,{className:"h-4 w-4 animate-spin mr-2"}),"Searching..."]})]})}),pe.jsxs("div",{className:"divide-y divide-gray-200",children:[0===l.length&&a&&!i&&pe.jsxs("div",{className:"px-6 py-12 text-center",children:[pe.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No results found"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search terms or filters."})]}),l.map((e,s)=>{return pe.jsx("div",{onClick:()=>(e=>{t&&t(e)})(e),className:"px-6 py-4 hover:bg-gray-50 cursor-pointer transition-colors",children:pe.jsxs("div",{className:"flex items-start justify-between",children:[pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center mb-2",children:[pe.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium mr-3 ${S(e.type)}`,children:[C(e.type),pe.jsx("span",{className:"ml-1 capitalize",children:e.type})]}),pe.jsxs("span",{className:"text-sm text-gray-500",children:[e.leadName," • ",e.leadEmail]})]}),pe.jsxs("h4",{className:"text-sm font-medium text-gray-900 mb-1",children:["activity"===e.type&&e.data.subject,"proposal"===e.type&&e.data.title,"contract"===e.type&&(e.data.title||"Untitled Contract")]}),pe.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["activity"===e.type&&e.data.notes,"proposal"===e.type&&e.data.description,"contract"===e.type&&e.data.terms]}),pe.jsxs("div",{className:"flex items-center text-xs text-gray-500 space-x-4",children:[pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(U,{className:"h-3 w-3 mr-1"}),(a=e.timestamp,a.toLocaleDateString()+" "+a.toLocaleTimeString())]}),e.data.status&&pe.jsx("span",{className:"px-2 py-1 bg-gray-100 text-gray-800 rounded-full",children:e.data.status}),e.data.created_by&&pe.jsxs("span",{className:"flex items-center",children:[pe.jsx(D,{className:"h-3 w-3 mr-1"}),e.data.created_by]})]})]}),e.searchScore&&e.searchScore>0&&pe.jsx("div",{className:"ml-4 flex-shrink-0",children:pe.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[Math.round(10*e.searchScore),"% match"]})})]})},`${e.type}-${e.id}`);var a})]})]})]})}function nt(e,t){let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>e(...a),t)}}function it(){const[t,s]=e.useState("leads"),[a,r]=e.useState(null),[l,n]=e.useState(!1),[i,c]=e.useState(null),[d,o]=e.useState(""),[m,u]=e.useState([]),[x,h]=e.useState(!1),[y,j]=e.useState({status:"",source:"",tags:[]}),[v,N]=e.useState(!1),w=e=>{r(e)},C=e=>{c(e),n(!0)};e.useEffect(()=>{const e=setTimeout(()=>{d.trim()?(async()=>{if(d.trim()){h(!0);try{const e=g(De,"leads");let t=p(e);if(d.includes("@"))t=p(e,b("email_lower"),k(d.toLowerCase()),L(d.toLowerCase()+""));else if(/^\d+$/.test(d.replace(/\D/g,""))){const s=d.replace(/\D/g,"");t=p(e,b("phone_digits"),k(s),L(s+""))}else t=p(e,_("search_prefixes","array-contains",d.toLowerCase()));let s=(await f(t)).docs.map(e=>({lead_id:e.id,...e.data()}));y.status&&(s=s.filter(e=>e.status===y.status)),y.source&&(s=s.filter(e=>e.source===y.source)),y.tags.length>0&&(s=s.filter(e=>y.tags.some(t=>{var s;return null==(s=e.tags)?void 0:s.includes(t)}))),u(s)}catch(mt){u([])}finally{h(!1)}}else u([])})():u([])},300);return()=>clearTimeout(e)},[d,y]);return pe.jsxs("div",{className:"min-h-screen bg-gray-50",children:[pe.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:pe.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:pe.jsxs("div",{className:"flex justify-between items-center h-16",children:[pe.jsxs("div",{className:"flex items-center space-x-6",children:[pe.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"LEADS Management System"}),pe.jsxs("nav",{className:"flex space-x-4",children:[pe.jsxs("button",{onClick:()=>s("leads"),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+("leads"===t?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(ne,{className:"h-4 w-4 mr-2"}),"All Leads"]}),pe.jsxs("button",{onClick:()=>s("search"),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+("search"===t?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(O,{className:"h-4 w-4 mr-2"}),"Search"]}),pe.jsxs("button",{onClick:()=>s("search-grid"),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+("search-grid"===t?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Search Grid"]}),pe.jsxs("button",{onClick:()=>s("advanced-search"),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+("advanced-search"===t?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(O,{className:"h-4 w-4 mr-2"}),"Advanced Search"]}),pe.jsxs("button",{onClick:()=>s("subcollection-search"),className:"inline-flex items-center px-3 py-2 rounded-md text-sm font-medium "+("subcollection-search"===t?"bg-blue-100 text-blue-700":"text-gray-500 hover:text-gray-700"),children:[pe.jsx(O,{className:"h-4 w-4 mr-2"}),"Subcollection Search"]})]})]}),pe.jsx("div",{className:"flex items-center space-x-4",children:pe.jsxs("button",{onClick:()=>{c(null),n(!0)},className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[pe.jsx(W,{className:"h-4 w-4 mr-2"}),"Add Lead"]})})]})})}),pe.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:pe.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[pe.jsx("div",{className:"mb-6",children:pe.jsx(Ee,{})}),"leads"===t?pe.jsxs("div",{children:[pe.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"All Leads"}),pe.jsx($e,{onViewLead:w,onEditLead:C})]}):"search-grid"===t?pe.jsx(Je,{onViewLead:w,onEditLead:C}):"advanced-search"===t?pe.jsx(at,{onViewLead:w,onEditLead:C}):"subcollection-search"===t?pe.jsx(lt,{onResultClick:async e=>{try{const t=await f(p(g(De,"leads"),_("__name__","==",e.leadId)));if(!t.empty){const a=t.docs[0].data(),r={lead_id:e.leadId,...a};w(r),s("leads")}}catch(mt){}}}):pe.jsxs("div",{children:[pe.jsxs("div",{className:"flex items-center justify-between mb-6",children:[pe.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Search Leads"}),pe.jsxs("button",{onClick:()=>N(!v),className:"inline-flex items-center px-3 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50",children:[pe.jsx(R,{className:"h-4 w-4 mr-2"}),"Filters"]})]}),pe.jsxs("div",{className:"mb-6",children:[pe.jsxs("div",{className:"relative",children:[pe.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:pe.jsx(O,{className:"h-5 w-5 text-gray-400"})}),pe.jsx("input",{type:"text",placeholder:"Search by name, email, phone, or company...",value:d,onChange:e=>o(e.target.value),className:"block w-full pl-10 pr-12 py-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-lg"}),d&&pe.jsx("button",{onClick:()=>{o(""),u([]),j({status:"",source:"",tags:[]})},className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:pe.jsx(P,{className:"h-5 w-5 text-gray-400 hover:text-gray-600"})})]}),pe.jsx("div",{className:"mt-2 text-sm text-gray-500",children:pe.jsx("p",{children:"💡 Try searching by: name (John), email (john@company.com), phone (555), or company (Tech)"})})]}),v&&pe.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200 mb-6",children:[pe.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Filter Results"}),pe.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),pe.jsxs("select",{value:y.status,onChange:e=>j(t=>({...t,status:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"All Statuses"}),pe.jsx("option",{value:"new",children:"New"}),pe.jsx("option",{value:"contacted",children:"Contacted"}),pe.jsx("option",{value:"qualified",children:"Qualified"}),pe.jsx("option",{value:"proposal",children:"Proposal"}),pe.jsx("option",{value:"negotiation",children:"Negotiation"}),pe.jsx("option",{value:"closed-won",children:"Closed Won"}),pe.jsx("option",{value:"closed-lost",children:"Closed Lost"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source"}),pe.jsxs("select",{value:y.source,onChange:e=>j(t=>({...t,source:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"All Sources"}),pe.jsx("option",{value:"Website",children:"Website"}),pe.jsx("option",{value:"Referral",children:"Referral"}),pe.jsx("option",{value:"Cold Call",children:"Cold Call"}),pe.jsx("option",{value:"Event",children:"Event"}),pe.jsx("option",{value:"Partner",children:"Partner"})]})]}),pe.jsxs("div",{children:[pe.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),pe.jsxs("select",{value:"",onChange:e=>{const t=e.target.value;t&&!y.tags.includes(t)&&j(e=>({...e,tags:[...e.tags,t]}))},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",children:[pe.jsx("option",{value:"",children:"Select a tag..."}),pe.jsx("option",{value:"enterprise",children:"Enterprise"}),pe.jsx("option",{value:"small-business",children:"Small Business"}),pe.jsx("option",{value:"startup",children:"Startup"}),pe.jsx("option",{value:"active",children:"Active"}),pe.jsx("option",{value:"priority",children:"Priority"}),pe.jsx("option",{value:"new-market",children:"New Market"})]}),y.tags.length>0&&pe.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:y.tags.map((e,t)=>pe.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e,pe.jsx("button",{onClick:()=>j(t=>({...t,tags:t.tags.filter(t=>t!==e)})),className:"ml-1 text-blue-600 hover:text-blue-800",children:pe.jsx(P,{className:"h-3 w-3"})})]},t))})]})]})]}),x&&pe.jsxs("div",{className:"flex justify-center items-center py-12",children:[pe.jsx(le,{className:"h-8 w-8 animate-spin text-blue-600"}),pe.jsx("span",{className:"ml-2 text-gray-600",children:"Searching..."})]}),!x&&d&&0===m.length&&pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No leads found"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Try adjusting your search terms or filters."})]}),!x&&m.length>0&&pe.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:[pe.jsxs("div",{className:"px-4 py-5 sm:px-6 border-b border-gray-200",children:[pe.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:["Search Results (",m.length,")"]}),pe.jsxs("p",{className:"mt-1 max-w-2xl text-sm text-gray-500",children:["Found ",m.length,' leads matching "',d,'"']})]}),pe.jsx("ul",{className:"divide-y divide-gray-200",children:m.map(e=>pe.jsx("li",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50 cursor-pointer",onClick:()=>w(e),children:pe.jsx("div",{className:"flex items-center justify-between",children:pe.jsxs("div",{className:"flex-1 min-w-0",children:[pe.jsxs("div",{className:"flex items-center justify-between",children:[pe.jsxs("div",{className:"flex items-center",children:[pe.jsx(ne,{className:"h-5 w-5 text-gray-400 mr-3"}),pe.jsxs("div",{children:[pe.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.full_name||`${e.first_name} ${e.last_name}`}),pe.jsx("p",{className:"text-sm text-gray-500",children:e.email})]})]}),pe.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium "+("new"===e.status?"bg-yellow-100 text-yellow-800":"contacted"===e.status?"bg-blue-100 text-blue-800":"qualified"===e.status?"bg-green-100 text-green-800":"proposal"===e.status?"bg-purple-100 text-purple-800":"closed-won"===e.status?"bg-green-100 text-green-800":"closed-lost"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:e.status})]}),pe.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500 space-x-4",children:[e.phone&&pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("span",{className:"mr-1",children:"📞"}),e.phone]}),e.company&&pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("span",{className:"mr-1",children:"🏢"}),e.company]}),e.source&&pe.jsxs("div",{className:"flex items-center",children:[pe.jsx("span",{className:"mr-1",children:"📍"}),e.source]})]})]})})},e.lead_id))})]}),!d&&pe.jsxs("div",{className:"text-center py-12",children:[pe.jsx(O,{className:"mx-auto h-12 w-12 text-gray-400"}),pe.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Start searching for leads"}),pe.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Enter a name, email, phone number, or company name to find leads."})]})]})]})}),l&&pe.jsx(Ge,{lead:i,onSave:e=>{n(!1),c(null),window.location.reload()},onClose:()=>{n(!1),c(null)}}),!1,a&&pe.jsx(We,{lead:a,onClose:()=>r(null)})]})}const ct={},dt=function(e,t,s){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in ct)return;ct[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const r=document.createElement("link");return r.rel=t?"stylesheet":"modulepreload",t||(r.as="script"),r.crossOrigin="",r.href=e,s&&r.setAttribute("nonce",s),document.head.appendChild(r),t?new Promise((t,s)=>{r.addEventListener("load",t),r.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function r(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&r(e.reason);return e().catch(r)})},ot=e=>{const t={SearchBar:()=>dt(()=>import("./SearchBar-YIDngrHy.js"),__vite__mapDeps([0,1,2,3,4])),SearchResults:()=>dt(()=>import("./SearchResults-D4H8Tooj.js"),__vite__mapDeps([5,1,2,3,4])),ResultDetailDrawer:()=>dt(()=>import("./ResultDetailDrawer-CzD8tEsT.js"),__vite__mapDeps([6,1,3,4])),LeadForm:()=>dt(()=>import("./LeadForm-Dss6BovE.js"),__vite__mapDeps([7,1,3,4])),LeadsList:()=>dt(()=>Promise.resolve().then(()=>Fe),void 0)};return t[e]?t[e]():Promise.resolve(null)};be.createRoot(document.getElementById("root")).render(pe.jsx(s.StrictMode,{children:pe.jsx(it,{})})),"requestIdleCallback"in window?requestIdleCallback(()=>{ot("SearchBar"),ot("LeadsList")}):setTimeout(()=>{ot("SearchBar"),ot("LeadsList")},100);export{De as d,pe as j};
