import{j as e}from"./index-BgRM5gx4.js";import{r as s}from"./react-vendor-DtX1tuCI.js";import{u as t,s as a}from"./simpleSearchService-DmRmgA6D.js";import{b as l,X as r,L as n,c as o}from"./ui-vendor-DFpyUtHP.js";import"./firebase-vendor-C5ggpXef.js";const c=[{value:"global",label:"All",icon:e.jsx(l,{className:"w-4 h-4"})},{value:"leads",label:"Leads",icon:e.jsx(l,{className:"w-4 h-4"})},{value:"activities",label:"Activities",icon:e.jsx(l,{className:"w-4 h-4"})},{value:"proposals",label:"Proposals",icon:e.jsx(l,{className:"w-4 h-4"})},{value:"contracts",label:"Contracts",icon:e.jsx(l,{className:"w-4 h-4"})}];function i({onFocus:i,onBlur:u,placeholder:m="Search leads, activities, proposals...",className:d=""}){const{mode:x,term:h,loading:f,recentSearches:v,setMode:p,setTerm:b,setLoading:g,setError:y,setResults:j,setHasMore:w,setLastDoc:N,clearResults:k,addRecentSearch:S,getCachedResults:C,setCachedResults:E,searchKey:L}=t(),[R,D]=s.useState(!1),[K,M]=s.useState(!1),[T,B]=s.useState(!1),$=s.useRef(null),z=s.useRef(null),A=function(e,t){const[a,l]=s.useState(e);return s.useEffect(()=>{const s=setTimeout(()=>{l(e)},t);return()=>{clearTimeout(s)}},[e,t]),a}(h,300),F=s.useCallback(async(e,s,t=!1)=>{if(!e.trim())return void k();const l=`${s}-${e}`,r=C(l);if(!r||t){g(!0),y(null);try{const r=await a.search(s,e,{lastDoc:t?L:void 0});t?j([...C(L)||[],...r.results]):(j(r.results),E(l,r.results)),w(r.hasMore),N(r.lastDoc),S(e)}catch(n){y(n instanceof Error?n.message:"Search failed")}finally{g(!1)}}else j(r)},[x,g,y,j,w,N,k,S,C,E,L]);s.useEffect(()=>{A?F(A,x):k()},[A,x,F,k]);s.useEffect(()=>{const e=e=>{var s;(e.ctrlKey||e.metaKey)&&"k"===e.key&&(e.preventDefault(),null==(s=$.current)||s.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[]),s.useEffect(()=>{const e=e=>{z.current&&!z.current.contains(e.target)&&(M(!1),B(!1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const H=c.find(e=>e.value===x);return e.jsxs("div",{className:`relative ${d}`,ref:z,children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(l,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{ref:$,type:"text",value:h,onChange:e=>{b(e.target.value)},onFocus:()=>{D(!0),B(!0),null==i||i()},onBlur:()=>{setTimeout(()=>{D(!1),B(!1),M(!1),null==u||u()},150)},placeholder:m,className:"block w-full pl-10 pr-20 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),e.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center",children:[e.jsxs("button",{type:"button",onClick:()=>M(!K),className:"flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900 focus:outline-none",children:[null==H?void 0:H.icon,e.jsx("span",{className:"ml-1",children:null==H?void 0:H.label}),e.jsx("svg",{className:"ml-1 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),h&&e.jsx("button",{type:"button",onClick:()=>{var e;b(""),k(),null==(e=$.current)||e.focus()},className:"p-2 text-gray-400 hover:text-gray-600 focus:outline-none",children:e.jsx(r,{className:"h-4 w-4"})}),f&&e.jsx("div",{className:"p-2",children:e.jsx(n,{className:"h-4 w-4 animate-spin text-blue-500"})})]})]}),K&&e.jsx("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm",children:c.map(s=>e.jsxs("button",{onClick:()=>{return e=s.value,p(e),M(!1),void(h.trim()&&F(h,e));var e},className:"w-full text-left px-4 py-2 text-sm hover:bg-gray-100 flex items-center "+(x===s.value?"bg-blue-50 text-blue-600":"text-gray-900"),children:[s.icon,e.jsx("span",{className:"ml-2",children:s.label})]},s.value))}),T&&v.length>0&&!h&&e.jsxs("div",{className:"absolute z-10 mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm",children:[e.jsx("div",{className:"px-4 py-2 text-xs font-semibold text-gray-500 uppercase tracking-wide",children:"Recent Searches"}),v.map((s,t)=>e.jsxs("button",{onClick:()=>(e=>{b(e),B(!1),F(e,x)})(s),className:"w-full text-left px-4 py-2 text-sm text-gray-900 hover:bg-gray-100 flex items-center",children:[e.jsx(o,{className:"h-4 w-4 text-gray-400 mr-2"}),s]},t))]}),!R&&e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("kbd",{className:"inline-flex items-center px-2 py-1 border border-gray-200 rounded text-xs font-mono text-gray-500",children:"âŒ˜K"})})]})}export{i as SearchBar};
