import{j as e}from"./index-BgRM5gx4.js";import{r as s}from"./react-vendor-DtX1tuCI.js";import{u as a,s as t}from"./simpleSearchService-DmRmgA6D.js";import{M as r,P as l,j as c,U as n,T as i,c as d,l as m,k as x,L as o,g as h,b as u}from"./ui-vendor-DFpyUtHP.js";import"./firebase-vendor-C5ggpXef.js";const g=(s,a)=>{if(!a||!s)return s;const t=new RegExp(`(${a})`,"gi");return s.split(t).map((s,a)=>t.test(s)?e.jsx("mark",{className:"bg-yellow-200 px-1 rounded",children:s},a):s)};function j({result:s,onSelect:a,searchTerm:t}){var o,h,u,j;const p=(s=>{switch(s){case"lead":return e.jsx(n,{className:"h-4 w-4"});case"activity":return e.jsx(c,{className:"h-4 w-4"});case"proposal":return e.jsx(x,{className:"h-4 w-4"});case"contract":return e.jsx(m,{className:"h-4 w-4"});case"audit_log":return e.jsx(d,{className:"h-4 w-4"});default:return e.jsx(i,{className:"h-4 w-4"})}})(s.type),f=(e=>{switch(e.toLowerCase()){case"customer":case"active":case"accepted":return"bg-green-100 text-green-800";case"new":case"draft":case"pending":return"bg-yellow-100 text-yellow-800";case"lost":case"expired":case"rejected":case"cancelled":return"bg-red-100 text-red-800";case"contacted":case"qualified":case"proposal":case"negotiation":case"sent":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(s.status),N=(e=>{if(!e)return"";try{const s=e.toDate?e.toDate():new Date(e),a=((new Date).getTime()-s.getTime())/36e5;return a<1?"Just now":a<24?`${Math.floor(a)}h ago`:a<168?`${Math.floor(a/24)}d ago`:s.toLocaleDateString()}catch(s){return""}})(s.timestamp);return e.jsxs("div",{onClick:()=>{a(s)},className:"flex items-center p-4 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors duration-150",children:[e.jsx("div",{className:"flex-shrink-0 mr-3 text-gray-500",children:p}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 truncate",children:g(s.title,t)}),e.jsxs("div",{className:"flex items-center space-x-2 ml-2",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${f}`,children:s.status}),N&&e.jsx("span",{className:"text-xs text-gray-500",children:N})]})]}),s.subtitle&&e.jsx("p",{className:"text-sm text-gray-600 truncate",children:g(s.subtitle,t)}),e.jsxs("div",{className:"flex items-center mt-1 space-x-4 text-xs text-gray-500",children:["lead"===s.type&&(null==(o=s.data)?void 0:o.email)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(r,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"truncate max-w-32",children:g(s.data.email,t)})]}),"lead"===s.type&&(null==(h=s.data)?void 0:h.phone)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(l,{className:"h-3 w-3 mr-1"}),e.jsx("span",{children:g(s.data.phone,t)})]}),"activity"===s.type&&(null==(u=s.data)?void 0:u.type)&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(c,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"capitalize",children:s.data.type})]}),s.lead_name&&"lead"!==s.type&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),e.jsx("span",{className:"truncate max-w-32",children:g(s.lead_name,t)})]})]}),(null==(j=s.data)?void 0:j.tags)&&s.data.tags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[s.data.tags.slice(0,3).map((s,a)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs bg-gray-100 text-gray-700",children:s},a)),s.data.tags.length>3&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.data.tags.length-3," more"]})]}),e.jsx("div",{className:"mt-2 flex items-center",children:e.jsxs("span",{className:"bg-gray-100 px-2 py-1 rounded text-xs font-mono text-gray-500",children:["ID: ",s.id]})})]}),e.jsx("div",{className:"flex-shrink-0 ml-2",children:e.jsx("svg",{className:"h-4 w-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]})}function p({onSelect:r,className:l=""}){const{results:c,loading:n,error:i,hasMore:d,lastDoc:m,mode:x,term:g,filters:p,setLoading:f,setError:N,setResults:y,setHasMore:b,setLastDoc:v}=a(),w=s.useCallback(async()=>{if(d&&!n&&m){f(!0);try{const e=await t.loadMore(x,g,m,{filters:p});y([...c,...e.results],!0),b(e.hasMore),v(e.lastDoc)}catch(e){N(e instanceof Error?e.message:"Failed to load more results")}finally{f(!1)}}},[d,n,m,x,g,p,c,f,N,y,b,v]),k=s.useCallback(e=>{null==r||r(e)},[r]);return n&&0===c.length?e.jsx("div",{className:`flex items-center justify-center py-12 ${l}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(o,{className:"h-8 w-8 animate-spin text-blue-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Searching..."})]})}):i?e.jsx("div",{className:`flex items-center justify-center py-12 ${l}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{className:"h-8 w-8 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:"Search failed"}),e.jsx("p",{className:"text-gray-600 text-sm",children:i})]})}):!n&&0===c.length&&g?e.jsx("div",{className:`flex items-center justify-center py-12 ${l}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"h-8 w-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 mb-2",children:"No results found"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["No ","global"===x?"items":x,' found for "',g,'"']})]})}):g?e.jsxs("div",{className:l,children:[e.jsx("div",{className:"space-y-1",children:c.map((s,a)=>e.jsx(j,{result:s,onSelect:k,searchTerm:g},`${s.type}-${s.id}-${a}`))}),d&&e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:w,disabled:n,className:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:n?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"h-4 w-4 animate-spin mr-2"}),"Loading..."]}):"Load More"})}),c.length>0&&e.jsxs("div",{className:"mt-4 text-center text-sm text-gray-500",children:[c.length," result",1!==c.length?"s":""," found",d&&" (more available)"]})]}):e.jsx("div",{className:`flex items-center justify-center py-12 ${l}`,children:e.jsxs("div",{className:"text-center",children:[e.jsx(u,{className:"h-8 w-8 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Start typing to search"}),e.jsxs("p",{className:"text-gray-500 text-sm",children:["Search across ","global"===x?"all":x," to find what you're looking for"]})]})})}export{p as SearchResults};
