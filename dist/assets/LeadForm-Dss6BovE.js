import{j as e,d as s}from"./index-BgRM5gx4.js";import{r as t}from"./react-vendor-DtX1tuCI.js";import{T as a,y as r,n as l,m as n,j as o}from"./firebase-vendor-C5ggpXef.js";import{X as i,U as d,M as c,P as u,B as m,T as x,C as g,S as b}from"./ui-vendor-DFpyUtHP.js";const p=["new","contacted","qualified","proposal","negotiation","closed-won","closed-lost"],h=["active","churned","suspended"],f=["website","referral","social_media","email_campaign","cold_call","trade_show","linkedin","google_ads"],v=["enterprise","premium","active","startup","growth","innovative","established","renewal","fast-growing","global","strategic","mid-market","expansion","digital","security","compliance"];function y(e,s=15){if(!e)return[];const t=e.toLowerCase().replace(/[^a-z0-9@.]/g,""),a=[];for(let r=1;r<=Math.min(t.length,s);r++)a.push(t.slice(0,r));return a}function j({lead:j,isOpen:N,onClose:_,onSave:w}){var C,S,k;const[D,L]=t.useState({first_name:"",last_name:"",email:"",phone:"",status:"new",stage:"awareness",account_status:"active",source:"",tags:[],company:"",title:"",notes:"",assigned_to:"",expected_close_date:void 0,estimated_value:void 0,currency:"USD"}),[A,U]=t.useState(!1),[E,I]=t.useState({}),[P,T]=t.useState(""),[$,q]=t.useState(""),[F,z]=t.useState(null),[B,O]=t.useState(!1);t.useEffect(()=>{L(j?{first_name:j.first_name||"",last_name:j.last_name||"",email:j.email||"",phone:j.phone||"",status:j.status||"new",stage:j.stage||"awareness",account_status:j.account_status||"active",source:j.source||"",tags:j.tags||[],company:j.company||"",title:j.title||"",notes:j.notes||"",assigned_to:j.assigned_to||"",expected_close_date:j.expected_close_date,estimated_value:j.estimated_value,currency:j.currency||"USD"}:{first_name:"",last_name:"",email:"",phone:"",status:"new",stage:"awareness",account_status:"active",source:"",tags:[],company:"",title:"",notes:"",assigned_to:"",expected_close_date:void 0,estimated_value:void 0,currency:"USD"})},[j]);const R=async e=>{var t,i,d,c,u;if(e.preventDefault(),(()=>{const e={};return D.first_name.trim()||(e.first_name="First name is required"),D.last_name.trim()||(e.last_name="Last name is required"),D.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(D.email)||(e.email="Please enter a valid email address"):e.email="Email is required",D.phone.trim()||(e.phone="Phone number is required"),D.source.trim()||(e.source="Source is required"),I(e),0===Object.keys(e).length})()){U(!0);try{const e=a.now(),m=function(e){const s=(e.first_name||"").toLowerCase(),t=(e.last_name||"").toLowerCase(),a=`${s} ${t}`.trim(),r=(e.email||"").toLowerCase(),l=(e.phone||"").replace(/\D/g,""),n=(e.company||"").toLowerCase(),o=new Set([...y(s),...y(t),...y(a),...y(r),...y(l),...y(n)]);return Array.from(o)}(D),x={first_name:D.first_name.trim(),last_name:D.last_name.trim(),full_name:`${D.first_name.trim()} ${D.last_name.trim()}`,full_name_lower:`${D.first_name.trim()} ${D.last_name.trim()}`.toLowerCase(),email:D.email.trim(),email_lower:D.email.trim().toLowerCase(),phone:D.phone.trim(),phone_digits:D.phone.replace(/[^\d]/g,""),company:(null==(t=D.company)?void 0:t.trim())||"",company_lower:((null==(i=D.company)?void 0:i.trim())||"").toLowerCase(),title:(null==(d=D.title)?void 0:d.trim())||"",status:D.status,stage:D.stage,contract_value:D.estimated_value||0,account_status:D.account_status,source:D.source.trim(),created_at:(null==j?void 0:j.created_at)||e,updated_at:e,search_prefixes:m,tags:D.tags,notes:(null==(c=D.notes)?void 0:c.trim())||"",assigned_to:(null==(u=D.assigned_to)?void 0:u.trim())||"",expected_close_date:D.expected_close_date,estimated_value:D.estimated_value,currency:D.currency,address:{street:"",city:"",state:"",zip:"",country:"USA"}};if(j){const e={...x,lead_id:j.lead_id};await r(l(s,"leads",j.lead_id),x),z(j.lead_id),O(!0),w(e)}else{const e=await n(o(s,"leads"),x),t={...x,lead_id:e.id};z(e.id),O(!0),w(t)}}catch(m){I({submit:"Failed to save lead. Please try again."})}finally{U(!1)}}},M=(e,s)=>{L(t=>({...t,[e]:s})),E[e]&&I(s=>({...s,[e]:""}))},G=e=>{e&&!D.tags.includes(e)&&M("tags",[...D.tags,e])};return N?e.jsx("div",{className:"fixed inset-0 z-50 overflow-hidden bg-white",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 bg-white",children:[e.jsx("h2",{className:"text-2xl font-semibold text-gray-900",children:j?"Edit Lead":"Add New Lead"}),e.jsx("button",{onClick:_,className:"p-2 text-gray-400 hover:text-gray-600 focus:outline-none",children:e.jsx(i,{className:"h-6 w-6"})})]}),e.jsxs("form",{onSubmit:R,className:"flex-1 overflow-y-auto p-8 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(d,{className:"h-5 w-5 mr-2"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name *"}),e.jsx("input",{type:"text",value:D.first_name,onChange:e=>M("first_name",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(E.first_name?"border-red-300":"border-gray-300"),placeholder:"John"}),E.first_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E.first_name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name *"}),e.jsx("input",{type:"text",value:D.last_name,onChange:e=>M("last_name",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(E.last_name?"border-red-300":"border-gray-300"),placeholder:"Doe"}),E.last_name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E.last_name})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email *"}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"email",value:D.email,onChange:e=>M("email",e.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(E.email?"border-red-300":"border-gray-300"),placeholder:"john.doe@example.com"})]}),E.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone *"}),e.jsxs("div",{className:"relative",children:[e.jsx(u,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"tel",value:D.phone,onChange:e=>M("phone",e.target.value),className:"w-full pl-10 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(E.phone?"border-red-300":"border-gray-300"),placeholder:"+1-555-0123"})]}),E.phone&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E.phone})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(m,{className:"h-5 w-5 mr-2"}),"Company Information"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Company"}),e.jsx("input",{type:"text",value:D.company||"",onChange:e=>M("company",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Acme Corp"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title"}),e.jsx("input",{type:"text",value:D.title||"",onChange:e=>M("title",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"CEO"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Source *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("select",{value:D.source,onChange:e=>M("source",e.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 "+(E.source?"border-red-300":"border-gray-300"),children:[e.jsx("option",{value:"",children:"Select a source"}),f.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1).replace("_"," ")},s))]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),P.trim()&&(M("source",P.trim()),T(""))},className:"flex",children:[e.jsx("input",{type:"text",value:P,onChange:e=>T(e.target.value),placeholder:"Custom source...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{type:"submit",className:"px-3 py-2 text-sm bg-blue-600 text-white rounded-r-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Add"})]})]}),E.source&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:E.source})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(x,{className:"h-5 w-5 mr-2"}),"Status & Tags"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lead Status"}),e.jsx("select",{value:D.status,onChange:e=>M("status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:p.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Sales Stage"}),e.jsxs("select",{value:D.stage,onChange:e=>M("stage",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"awareness",children:"Awareness"}),e.jsx("option",{value:"interest",children:"Interest"}),e.jsx("option",{value:"consideration",children:"Consideration"}),e.jsx("option",{value:"intent",children:"Intent"}),e.jsx("option",{value:"evaluation",children:"Evaluation"}),e.jsx("option",{value:"purchase",children:"Purchase"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Account Status"}),e.jsx("select",{value:D.account_status,onChange:e=>M("account_status",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:h.map(s=>e.jsx("option",{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags"}),D.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:D.tags.map(s=>e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[s,e.jsx("button",{type:"button",onClick:()=>{return e=s,void M("tags",D.tags.filter(s=>s!==e));var e},className:"ml-1 text-blue-600 hover:text-blue-800",children:e.jsx(i,{className:"h-3 w-3"})})]},s))}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-2",children:v.map(s=>e.jsx("button",{type:"button",onClick:()=>G(s),disabled:D.tags.includes(s),className:"px-3 py-2 text-sm rounded-md border transition-colors "+(D.tags.includes(s)?"bg-blue-50 border-blue-200 text-blue-700 cursor-not-allowed":"bg-white border-gray-300 text-gray-700 hover:bg-gray-50"),children:s},s))}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),$.trim()&&(G($.trim()),q(""))},className:"flex",children:[e.jsx("input",{type:"text",value:$,onChange:e=>q(e.target.value),placeholder:"Custom tag...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-l-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("button",{type:"submit",className:"px-3 py-2 text-sm bg-blue-600 text-white rounded-r-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Add"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(g,{className:"h-5 w-5 mr-2"}),"Additional Information"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assigned To"}),e.jsx("input",{type:"text",value:D.assigned_to||"",onChange:e=>M("assigned_to",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"sales@company.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Expected Close Date"}),e.jsx("input",{type:"date",value:D.expected_close_date?(null==(k=null==(S=(C=D.expected_close_date).toDate)?void 0:S.call(C))?void 0:k.toISOString().split("T")[0])||new Date(D.expected_close_date).toISOString().split("T")[0]:"",onChange:e=>M("expected_close_date",e.target.value?a.fromDate(new Date(e.target.value)):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estimated Value"}),e.jsx("input",{type:"number",value:D.estimated_value||"",onChange:e=>M("estimated_value",e.target.value?parseFloat(e.target.value):void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"5000"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Currency"}),e.jsxs("select",{value:D.currency,onChange:e=>M("currency",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"USD",children:"USD"}),e.jsx("option",{value:"EUR",children:"EUR"}),e.jsx("option",{value:"GBP",children:"GBP"}),e.jsx("option",{value:"CAD",children:"CAD"})]})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes"}),e.jsx("textarea",{value:D.notes||"",onChange:e=>M("notes",e.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Additional notes about this lead..."})]})]}),B&&F&&e.jsx("div",{className:"mt-4 p-4 bg-green-50 border border-green-200 rounded-md",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-green-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-green-800",children:j?"Lead Updated Successfully!":"Lead Created Successfully!"}),e.jsxs("div",{className:"mt-2 text-sm text-green-700",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Document ID:"})," ",e.jsx("code",{className:"bg-green-100 px-2 py-1 rounded text-xs font-mono",children:F})]}),e.jsx("p",{className:"mt-1",children:"You can use this ID to search for the lead in your database."})]}),e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>{O(!1),z(null),_()},className:"bg-green-100 text-green-800 px-3 py-1 rounded text-sm hover:bg-green-200 transition-colors",children:"Close"})})]})]})}),E.submit&&e.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:E.submit})})]}),e.jsx("div",{className:"border-t border-gray-200 p-6 bg-white",children:e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),e.jsx("button",{type:"submit",onClick:R,disabled:A,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:A?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),j?"Update Lead":"Create Lead"]})})]})})]})}):null}export{j as LeadForm};
